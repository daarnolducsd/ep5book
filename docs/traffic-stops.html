<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Traffic Stops | Econ5/Poli5D</title>
<meta name="author" content="David Arnold">
<meta name="description" content="3.1 SOPP Intro   code {  background-color: #f1f1f1; } The most common way civilians interact with police are through traffic stops (there are about 50,000 a day). Given the frequency of...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 3 Traffic Stops | Econ5/Poli5D">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/geisel.jpg">
<meta property="og:description" content="3.1 SOPP Intro   code {  background-color: #f1f1f1; } The most common way civilians interact with police are through traffic stops (there are about 50,000 a day). Given the frequency of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Traffic Stops | Econ5/Poli5D">
<meta name="twitter:description" content="3.1 SOPP Intro   code {  background-color: #f1f1f1; } The most common way civilians interact with police are through traffic stops (there are about 50,000 a day). Given the frequency of...">
<meta name="twitter:image" content="/images/geisel.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Econ5/Poli5D</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li class="book-part">Excel</li>
<li><a class="" href="college-experiments.html"><span class="header-section-number">1</span> College Experiments</a></li>
<li class="book-part">Stata</li>
<li><a class="" href="intergenerational-mobility.html"><span class="header-section-number">2</span> Intergenerational Mobility</a></li>
<li><a class="active" href="traffic-stops.html"><span class="header-section-number">3</span> Traffic Stops</a></li>
<li><a class="" href="classroom-technology.html"><span class="header-section-number">4</span> Classroom Technology</a></li>
<li class="book-part">R</li>
<li><a class="" href="resume-experiments.html"><span class="header-section-number">5</span> Resume Experiments</a></li>
<li><a class="" href="the-rug-rat-race.html"><span class="header-section-number">6</span> The Rug Rat Race</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="traffic-stops" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Traffic Stops<a class="anchor" aria-label="anchor" href="#traffic-stops"><i class="fas fa-link"></i></a>
</h1>
<div id="sopp-intro" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> SOPP Intro<a class="anchor" aria-label="anchor" href="#sopp-intro"><i class="fas fa-link"></i></a>
</h2>


<style>
code {
  background-color: #f1f1f1;
}
</style>
<p>The most common way civilians interact with police are through traffic stops (there are about 50,000 a day). Given the frequency of encounters, detecting and eliminating racial discrimination in police behavior is an important policy goal. However, it can be difficult to detect without data. In this chapter, we will work with data from the Stanford Open Policing Project (SOPP). The SOPP is aggregating data on police stops across states and cities so that researchers, journalists and policymakers can improve interactions between police and the public. The data so far has information on about 200 million stops.</p>
<p>This is some big data. Figure <a href="traffic-stops.html#fig:soppsnap">3.1</a> shows a subset of all the cities in that data has been collected for.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:soppsnap"></span>
<img src="images/03_data.png" alt="The Stanford Open Policing Project Data" width="75%"><p class="caption">
Figure 3.1: The Stanford Open Policing Project Data
</p>
</div>
<p>The data and research is starting to get notice by many news outlets, including CNN, the Economist, the Huffington Post, NBC News and the Daily Show (see Figure <a href="traffic-stops.html#fig:dailyshow">3.2</a>)</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dailyshow"></span>
<img src="images/03_daily_show.png" alt="Trevor Noah Discussing Results from The Stanford Open Policing Project Data" width="70%"><p class="caption">
Figure 3.2: Trevor Noah Discussing Results from The Stanford Open Policing Project Data
</p>
</div>
<p>There are many different “decisions” that officers make that could be driven by discrimination</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>The decision to stop a vehicle or not</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Conditional on stop, whether to issue a citation or not</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Conditional on stop, whether to search the car or not</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>Conditional on stop, whether to arrest the individual or not</li>
</ol></li>
</ul>
<p>This data allows researchers to study all these potential margins for discrimination. Given the huge amount of data and the many margins that we could study, it will be helpful to narrow our focus. We will be studying <strong>disparities in traffic stop rates</strong> by the <strong>race</strong> of the motorists. Other possibilities would be to explore disparities in later stages of the traffic stops (citation/search/arrest) or other characteristics of the motorist (gender/age). Because the data is massive, we will focus on San Diego.</p>
</div>
<div id="sopp-data" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> SOPP Data<a class="anchor" aria-label="anchor" href="#sopp-data"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have narrowed our focus, let’s start exploring the data for San Diego, as always we will need to set our working directory to where the data is located and then use the <code>use</code> command to load the data.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb38-1"><a href="traffic-stops.html#cb38-1" aria-hidden="true" tabindex="-1"></a>cd <span class="st">"/Users/davidarnold/Dropbox/Teaching/EP5/online/03_week/data"</span></span>
<span id="cb38-2"><a href="traffic-stops.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> san_diego_stops.dta, <span class="kw">replace</span> </span>
<span id="cb38-3"><a href="traffic-stops.html#cb38-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb38-4"><a href="traffic-stops.html#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="traffic-stops.html#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="traffic-stops.html#cb38-6" aria-hidden="true" tabindex="-1"></a>/Users/davidarnold/Dropbox/Teaching/EP5/online/03_week/<span class="kw">data</span></span></code></pre></div>
<p>To begin, let’s use <code>describe</code> to figure out what variables we have in this dataset</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb39-1"><a href="traffic-stops.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sandiegostops"></span>
<img src="images/03_describe.png" alt="San Diego Stops Data from Stanford Open Policing Project Data" width="90%"><p class="caption">
Figure 3.3: San Diego Stops Data from Stanford Open Policing Project Data
</p>
</div>
<p>Each observation in the dataset is a stop made by an officer somewhere in San Diego. <code>stop_time</code> contains the time of the stop. Remember this variable, we will return to it later. Our goal is to understand if there is discrimination in who is stopped. Therefore, we will be frequently using the <code>subject_race</code> variable in our dataset.</p>
<p>Subject race is a <strong>categorical variable</strong>. Whenever you have a categorical variable as your variable of interest, it is helpful to understand the frequency of each category. For example, what fraction of stops are for Black drivers, White Drivers, Hispanic Drivers, etc. To do this in Stata, we will use the <code>tab</code> command.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb40-1"><a href="traffic-stops.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> subject_race</span>
<span id="cb40-2"><a href="traffic-stops.html#cb40-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb40-3"><a href="traffic-stops.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="traffic-stops.html#cb40-4" aria-hidden="true" tabindex="-1"></a>          subject_race |      Freq.     Percent        Cum.</span>
<span id="cb40-5"><a href="traffic-stops.html#cb40-5" aria-hidden="true" tabindex="-1"></a>-----------------------+-----------------------------------</span>
<span id="cb40-6"><a href="traffic-stops.html#cb40-6" aria-hidden="true" tabindex="-1"></a>Asian/Pacific Islander |     32,482        8.52        8.52</span>
<span id="cb40-7"><a href="traffic-stops.html#cb40-7" aria-hidden="true" tabindex="-1"></a>                 Black |     42,631       11.18       19.71</span>
<span id="cb40-8"><a href="traffic-stops.html#cb40-8" aria-hidden="true" tabindex="-1"></a>              Hispanic |    116,912       30.67       50.38</span>
<span id="cb40-9"><a href="traffic-stops.html#cb40-9" aria-hidden="true" tabindex="-1"></a>                 Other |     27,170        7.13       57.51</span>
<span id="cb40-10"><a href="traffic-stops.html#cb40-10" aria-hidden="true" tabindex="-1"></a>                 White |    161,954       42.49      100.00</span>
<span id="cb40-11"><a href="traffic-stops.html#cb40-11" aria-hidden="true" tabindex="-1"></a>-----------------------+-----------------------------------</span>
<span id="cb40-12"><a href="traffic-stops.html#cb40-12" aria-hidden="true" tabindex="-1"></a>                 Total |    381,149      100.00</span></code></pre></div>
<p>This gives us the fraction of stops for different races in San Diego. To begin to understand whether there is a disparity in traffic stops by race, we can compare the composition of traffic stops to the overall population to see if certain groups are over/underrepresented </p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:population"></span>
<img src="images/03_population.png" alt="Racial Composition of Traffic Stops and Population" width="60%"><p class="caption">
Figure 3.4: Racial Composition of Traffic Stops and Population
</p>
</div>
<p>As can be seen in Figure <a href="traffic-stops.html#fig:population">3.4</a>, Black drivers over-represented in police stops. 11.1 percent of all stops are Black drivers while 6.7 percent of the population is Black. Asian/Pacific Islander are underrepresented in traffic stops (8.5 percent of stops vs. 15.9 percent of population). Hispanic drivers are slightly overrepresented in traffic stops (30.7 percent of stops vs. 28.8 percent of population) while White drivers are slightly underrepresented (42.5 percent of stops vs. 45.1 percent of population). One important caveat is that demographic information is from 2010 Census, while traffic stop data is from 2014-2017. Therefore, these numbers may not be directly comparable if demographics are changing over time in San Diego.</p>
<p>However, this analysis does present some striking disparities in traffic stops. These disparities will be the focus of our analysis in this section. In particular, we will learn one test that can be used to understand whether these disparities are driven by racial discrimination on the part of police officers.</p>
</div>
<div id="veil-of-darkness-vod" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Veil of Darkness (VOD)<a class="anchor" aria-label="anchor" href="#veil-of-darkness-vod"><i class="fas fa-link"></i></a>
</h2>
<p>Racial disparities refer to any differences between groups of different races. Many factors can cause racial disparities, but common focus is to try to understand if the disparity is driven by racial discrimination. In our example, we are interested in exploring racial discrimination on the part of police officers making traffic stops. There are many methods that have been proposed to prove racial discrimination. Today we focus on one: <strong>the veil of darkness test</strong>, a test developed by Grogger and Ridgeway (2006)<span class="citation"><a href="references-1.html#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></span>.</p>
<p>The basic idea behind the veil of darkness test is that it easier to observe the race of an individual driver during the day when there is sunlight. Therefore, if police officers are pulling over drivers based on race, this will be harder to accomplish at night. We can therefore compare the racial composition of traffic stops during daylight vs. nighttime to try to infer racial discrimination on the part of police officers.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:veil1"></span>
<img src="images/03_veil1.png" alt="Assumptions Behind Veil of Darkness Test" width="75%"><p class="caption">
Figure 3.5: Assumptions Behind Veil of Darkness Test
</p>
</div>
<p>In Figure <a href="traffic-stops.html#fig:veil1">3.5</a> the basic assumptions behind the veil of darkness test is presented. Before sunset, it is light out, and officers can observe the race of drivers. After sunset (but before dusk), it is unclear whether race is observed or not. After dusk, however, we assume officers can no longer observe race before making the decision to stop a given driver.</p>
<p>In the data, imagine we see stops for a given type of drive fall dramatically after dusk. This might suggest that officers were targeting these individuals before dusk. But before we make any firm conclusions, we need to think carefully about comparing across different times in the day.</p>
<p>For example, at 12 noon it is light out. At 12 midnight it is dark out. However, there are many differences between 12 noon and 12 midnight. The drivers on the road are probably completely different. Therefore, if the racial composition of stops is different at these times, maybe it is not due to the officers, but due to the drivers on the road?</p>
<p>To get around this issue, Grogger and Ridgeway (2006) focus on the intertwilight period, which are times in which it is sometimes light out and sometimes dark.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:veil2"></span>
<img src="images/03_veil2.png" alt="The Intertwilight Period" width="75%"><p class="caption">
Figure 3.6: The Intertwilight Period
</p>
</div>
<p>For example, 6:30 PM is sometimes light out in San Diego (in the summer). However, 6:30 PM is sometimes dark in San Diego (in the winter). Therefore, maybe we can compare the composition of traffic stops around 6:30 PM and see if stops are more common for minority drivers when it is light out.</p>
<p>For example, imagine 40 percent of drivers stopped are Black when it is light out (at 6:30 PM), but 35 percent of drivers stopped are Black when it is dark out (still 6:30 PM, but a different part of the year). In this hypothetical example, the decrease in stops for Black drivers must be due to officers inability to racial profile when it is dark.</p>
<p>To implement this test in our data, we need a few more things. We have information on the time the traffic stop occurs, but we need to know if it is light or dark out when the traffic stop is made in order to implement the test. To add this to our dataset we will need to <strong>merge</strong> in external data on sunset times. This will introduce us to <strong>data wrangling</strong> in Stata</p>
</div>
<div id="data-wrangling" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Data Wrangling<a class="anchor" aria-label="anchor" href="#data-wrangling"><i class="fas fa-link"></i></a>
</h2>
<p>When you start an empirical research project in the social sciences, you must ask the question: what data can I use to answer this question? Once you have identified the data, it rarely comes in a format that is ready for data analysis. Generally, there are a number of steps that must be taken to prepare the data before analysis. These steps are often referred to as <strong>data wrangling</strong></p>
<p>For example, the Census has confidential income data that is available only to researchers that go through an application process. The data, however, is stored separately for every state. To create a master dataset, you would need to combine all these individual datasets together. This is a form of data wrangling. In Stata, this is accomplished with the <strong>append</strong> command</p>
<p>Next, imagine you are interested in the relationship between economic conditions and the opioid crisis in the United States. The Bureau of Labor Statistics provides county-level information on unemployment. The Centers for Disease Control and Prevention (CDC) provides county-level opioid prescription data. To study this question, we would need to combine these two datasets together at the county level. This is another example of data wrangling, and in Stata, this is accomplished with the <strong>merge</strong> command</p>
<p>Lastly, imagine you have individual-level data on voting rates, but you are interested in comparing voting rates across county. In other words, it would be more convenient for your analysis to have a dataset at the county level, rather than at the individual level. This is another example of data wrangling, and in Stata, this can be accomplished with the <strong>collapse</strong> command.</p>
<p>In this section, we will learn about all three of these commands: append, merge, and collapse, with a particular focus on (1) when is each appropriate and (2) how do we, in practice, implement them.</p>
</div>
<div id="append" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Append<a class="anchor" aria-label="anchor" href="#append"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>append</code> command is used when you want to <strong>add rows</strong> to a dataset. This is common in many situations. For example, it is common that datasets are stored separately for each year, but you want to analyze data across years. It is also common for datasets that are stored separately for each region by you want to analyze data for the entire country.</p>
<p>To understand how to use the append command we will consider a simple hypothetical example depicted in Figure <a href="traffic-stops.html#fig:appendhyp">3.7</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:appendhyp"></span>
<img src="images/03_append.png" alt="Hypothetical Data We Want to Append Together" width="60%"><p class="caption">
Figure 3.7: Hypothetical Data We Want to Append Together
</p>
</div>
<p>In this example, we have two classes: A and B, each with two students. In each dataset, we have the same variables. Our goal with append is to create a new dataset with 4 observations, 2 for each school.</p>
<p>How do we accomplish thos in Stata? If class A data is stored in <code>classA.dta</code> and class B data is stored in <code>classB.dta</code> we can combine them by typing:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb41-1"><a href="traffic-stops.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> classA.dta, <span class="kw">clear</span> </span>
<span id="cb41-2"><a href="traffic-stops.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> classB.dta </span></code></pre></div>
<p>What we have done is first load in the class A data by typing <code>classA.dta</code>. Then we have <code>appended</code> the class B data by typing <code>append using classB.dta</code>. In order for this code to work, both <code>classA.dta</code> and <code>classB.dta</code> need to be in the working directory for this command to work</p>
<p>In this example, we had two datasets to combine. Imagine we had more, for example, class C, class D and so on.You can continue to <code>append</code> more datasets by typing, for example, <code>append using classC.dta</code> followed by <code>append using classD.dta</code> and so on.</p>
</div>
<div id="merge-basics" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Merge Basics<a class="anchor" aria-label="anchor" href="#merge-basics"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>merge</code> command is used when you want to <strong>add columns</strong> to a dataset. For example, we are often interested in relationships between different variables. But if the variables are not in the same dataset, we need a way to combine datasets. A lot of cutting-edge research in social sciences stems from merging together previously unlinked datasets to observe new relationships.</p>
<p>Whenever you merge two datasets in Stata, you first need to identify two things. First, what variable can the data merged on? For example, if you have two individual-level datasets, you need a unique identifier to merge individuals. If you were trying to merge two datasets on students, the a unique student identifier would be a good option. Before merging, you need to identify this variable to merge on and verify it is stored in the same format in both datasets. In many cases, there are many ways to hold the same information. For example, if you are matching two datasets at the state level, the information could be stored as abbreviations (e.g. CA), full state name (e.g. California), or a numeric state code (e.g. the value 6 is equal to California for the Federal Information Processing System: FIPS). To merge datasets the information in both datasets must be stored in the same way.</p>
<p>The second task is to identify the type of merge. There are three types of merges in Stata: one-to-one, many-to-one and one-to-many. To understand the differences between these types of merges we will go through a few simple examples.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:merge1to1"></span>
<img src="images/03_merge_one.png" alt="Example of a one-to-one Merge" width="60%"><p class="caption">
Figure 3.8: Example of a one-to-one Merge
</p>
</div>
<p>In each dataset, there is a unique value for <code>student</code> for every observation. This is referred to as a one-to-one merge because we are matching each student in the school dataset to a single student in the gpa dataset.</p>
<p>A many-to-one merge or one-to-many merge is when the variable that is being merged on has multiple observations for some values. For example, in Figure (fig:mergemto1). In this merge, we are merging on the variable <code>school.</code> But in the student-level dataset, there are multiple observations per school. In particular, students 1 and 2 attend school A, while students 3 and 4 attend school B. In the school-level dataset there is a single observation per school. This is why this is referred to as a many-to-one merge. There are many observations per school in the first dataset, but one observation per school in the second.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mergemto1"></span>
<img src="images/03_merge_many.png" alt="Example of a many-to-one Merge" width="60%"><p class="caption">
Figure 3.9: Example of a many-to-one Merge
</p>
</div>
<p>To merge two datasets in Stata, the process takes a few steps. First, you must load one of the two datasets into memory. Whichever dataset you load first is referred to as the <strong>master dataset</strong>. Next, you use the <code>merge</code> command to combine the master dataset with the second of the two datasets. The dataset you are merging to is called the <strong>using dataset</strong>.</p>
<p>Let’s try this out on a few simple datasets. Imagine we have the two datasets below (<code>school.dta</code> and <code>gpa.dta</code>) and we want to combine them.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:merge1to1stata"></span>
<img src="images/03_merge1to1.png" alt="Merging Student-Level Datasets" width="60%"><p class="caption">
Figure 3.10: Merging Student-Level Datasets
</p>
</div>
<p>The first step is to load one of the two datasets.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb42-1"><a href="traffic-stops.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> school.dta, <span class="kw">clear</span> </span></code></pre></div>
<p>Because we loaded <code>school.dta</code> first, <code>school.dta</code> is the master dataset. We will now merge it to <code>gpa.dta</code>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb43-1"><a href="traffic-stops.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:1 student <span class="kw">using</span> gpa.dta</span></code></pre></div>
<p>When using the <code>merge</code> command we always need to make sure of a few components. First, we have specified <code>student</code> is the variable we will merge on. Therefore, each student in <code>school.dta</code> will be matched to the corresponding student in <code>gpa.dta</code>. Second, we have specified <code>1:1</code> because each student is a unique observation in both datasets. Lastly, we have specified that we are merging to <code>gpa.dta</code> by specifying <code>using gpa.dta</code>.</p>
Now let’s try a many-to-one merge. Imagine we have the two datasets below (<code>school.dta</code> and <code>pop.dta</code>) and we want to combine them.
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mergemto1stata"></span>
<img src="images/03_merge1to1.png" alt="Merging Student-Level Dataset to School-level Dataset" width="60%"><p class="caption">
Figure 3.11: Merging Student-Level Dataset to School-level Dataset
</p>
</div>
<p>There are two main differences here. First, we will now be merging on the variable <code>school</code>, as that is the variable that is common between both the datasets. Second, in the <code>school.dta</code>dataset, there are multiple observations for each school. In the <code>pop.dta</code>, there is a single observation per school. Therefore this will be a many-to-one merge instead of a one-to-one merge. Therefore, the code to merge the two datasets is now:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb44-1"><a href="traffic-stops.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> school.dta, <span class="kw">clear</span></span>
<span id="cb44-2"><a href="traffic-stops.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 school <span class="kw">using</span> pop.dta</span></code></pre></div>
<p>We specify <code>m:1</code> because there is are multiple observations per school in the master dataset, and a single in the using. A one-to-many merge (<code>1:m</code>) is conceptually similar. If we had loaded <code>pop.dta</code> first, then <code>pop.dta</code> would be the master dataset. In this case, the code to merge the two datasets is given by</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb45-1"><a href="traffic-stops.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> pop.dta, <span class="kw">clear</span></span>
<span id="cb45-2"><a href="traffic-stops.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:<span class="fu">m</span> school <span class="kw">using</span> school.dta</span></code></pre></div>
<p>The reason we switched to <code>1:m</code> is because there is a single observation per school in the master dataset and multiple in the using dataset now that <code>pop.dta</code> is the master dataset and <code>school.dta</code> is the using dataset.</p>
</div>
<div id="merge-advanced" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Merge Advanced<a class="anchor" aria-label="anchor" href="#merge-advanced"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, two datasets won’t merge completely. For example, consider the two datasets in Figure (fig:impmerge).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:impmerge"></span>
<img src="images/03_imp_merge.png" alt="Example of Merge with Unmatched Observations" width="60%"><p class="caption">
Figure 3.12: Example of Merge with Unmatched Observations
</p>
</div>
<p>In this example, student 1 has a test score, but no homework score, while student 6 has a homework score but no test score. Let’s see what happens if we merge these two datasets in Stata.</p>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...


/Users/davidarnold/Dropbox/Teaching/EP5/online/03_week/data</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb47-1"><a href="traffic-stops.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*load test score data*/</span></span>
<span id="cb47-2"><a href="traffic-stops.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> test_score.dta, <span class="kw">clear</span> </span>
<span id="cb47-3"><a href="traffic-stops.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="traffic-stops.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*merge to the hw data*/</span></span>
<span id="cb47-5"><a href="traffic-stops.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:1 student <span class="kw">using</span> hw_score.dta</span>
<span id="cb47-6"><a href="traffic-stops.html#cb47-6" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb47-7"><a href="traffic-stops.html#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="traffic-stops.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    Result                      Number <span class="kw">of</span> <span class="kw">obs</span></span>
<span id="cb47-9"><a href="traffic-stops.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    -----------------------------------------</span>
<span id="cb47-10"><a href="traffic-stops.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    Not matched                             2</span>
<span id="cb47-11"><a href="traffic-stops.html#cb47-11" aria-hidden="true" tabindex="-1"></a>        from master                         1  (<span class="dt">_merge</span>==1)</span>
<span id="cb47-12"><a href="traffic-stops.html#cb47-12" aria-hidden="true" tabindex="-1"></a>        from <span class="kw">using</span>                          1  (<span class="dt">_merge</span>==2)</span>
<span id="cb47-13"><a href="traffic-stops.html#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="traffic-stops.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    Matched                                 4  (<span class="dt">_merge</span>==3)</span>
<span id="cb47-15"><a href="traffic-stops.html#cb47-15" aria-hidden="true" tabindex="-1"></a>    -----------------------------------------</span></code></pre></div>
<p>Two observations were not matched. One from the master dataset (<code>test_score.dta</code>) and the other from the using dataset (<code>hw_score.dta</code>). A new variable (named <code>_merge</code>) has been added to the dataset to keep track of matched vs. unmatched observations. It is equal to 1 for observations only in the master dataset, 2 for observations only in the using, and 3 for observations in both the master and the using dataset.</p>
<p>Whether you keep unmatched observations in your dataset depends a bit on your analysis. If you really need both homework score and test score for all of your analysis, you can probably safely keep only matched observations. To do this in Stata after a <code>merge</code> command, we can type</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb48-1"><a href="traffic-stops.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_merge</span>==3</span>
<span id="cb48-2"><a href="traffic-stops.html#cb48-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb48-3"><a href="traffic-stops.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="traffic-stops.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="traffic-stops.html#cb48-5" aria-hidden="true" tabindex="-1"></a>(2 observations deleted)</span></code></pre></div>
<p>You can also specify to only keep matched observations directly in the merge command. If you are only keeping observations that match between the two datasets, you don’t need to generate the <code>_merge</code> variable, as it will be equal to 3 for all matched observations. Instead, you can specify the option <code>keep(3)</code> which only keeps matched observations. Then, in order to prevent Stata from adding an uniformative variable <code>_merge</code>, you can also specify <code>nogen</code> so that the variable is not generated. The example below uses both these options in the context of our hypothetical example.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb49-1"><a href="traffic-stops.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> test_score.dta, <span class="kw">clear</span> </span>
<span id="cb49-2"><a href="traffic-stops.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:1 student <span class="kw">using</span> hw_score.dta, <span class="kw">keep</span>(3) nogen</span>
<span id="cb49-3"><a href="traffic-stops.html#cb49-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb49-4"><a href="traffic-stops.html#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="traffic-stops.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    Result                      Number <span class="kw">of</span> <span class="kw">obs</span></span>
<span id="cb49-6"><a href="traffic-stops.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    -----------------------------------------</span>
<span id="cb49-7"><a href="traffic-stops.html#cb49-7" aria-hidden="true" tabindex="-1"></a>    Not matched                             0</span>
<span id="cb49-8"><a href="traffic-stops.html#cb49-8" aria-hidden="true" tabindex="-1"></a>    Matched                                 4  </span>
<span id="cb49-9"><a href="traffic-stops.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    -----------------------------------------</span></code></pre></div>
<p>As you can see, the generated table has only 4 observations now, all of which are in both datasets. This is because we have specified to only keep observations that are in both datasets by specifying <code>keep(3)</code>.</p>
<p>Now that we understand how to use the <code>merge</code> command, let’s go through a few common mistakes. The first has to deal with the matching variable. The matching variables need to be named in the exact same way.</p>
<p>In the example below (Figure (fig:samename)), the two datasets are the same as the previous example, but the student variable is named <code>student_id</code> in one and <code>student</code> in the other</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:samename"></span>
<img src="images/03_samename.png" alt="Example of Merge with Different Names for Matching Varaibles" width="60%"><p class="caption">
Figure 3.13: Example of Merge with Different Names for Matching Varaibles
</p>
</div>
<p>Let’s see what happens if we try to merge these two together:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb50-1"><a href="traffic-stops.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> test_score2.dta, <span class="kw">clear</span> </span>
<span id="cb50-2"><a href="traffic-stops.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:1 student_id <span class="kw">using</span> hw_score.dta</span>
<span id="cb50-3"><a href="traffic-stops.html#cb50-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb50-4"><a href="traffic-stops.html#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="traffic-stops.html#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="traffic-stops.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="traffic-stops.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="kw">variable</span> student_id <span class="kw">not</span> found</span>
<span id="cb50-8"><a href="traffic-stops.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(111);</span>
<span id="cb50-9"><a href="traffic-stops.html#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="traffic-stops.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">of</span> <span class="kw">do</span>-file</span>
<span id="cb50-11"><a href="traffic-stops.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(111);</span></code></pre></div>
<p>The variable <code>student_id</code> was not found because the variable <code>student_id</code> does not exist in the using dataset. In order to merge these two datasets together properly, we need to make sure the names of the variables are the same. If they are not, you can use the <code>rename</code> command to ensure the names are the same.</p>
<p>Similarly, matching variables not only have to have the same name, but they must be the same type of variable. For example, in Figure <a href="traffic-stops.html#fig:sametype">3.14</a>, the student variable is stored as a string in the first dataset (which is why it is highlighted in red), while it is stored as a numeric variable in the second dataset (which is why it is highlighted in black).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sametype"></span>
<img src="images/03_sameformat.png" alt="Example of Merge with Different Types for Matching Variable" width="60%"><p class="caption">
Figure 3.14: Example of Merge with Different Types for Matching Variable
</p>
</div>
<p>Let’s see what happens if we try to merge these two together</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb51-1"><a href="traffic-stops.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> test_score3.dta, <span class="kw">clear</span> </span>
<span id="cb51-2"><a href="traffic-stops.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> 1:1 student <span class="kw">using</span> hw_score.dta</span>
<span id="cb51-3"><a href="traffic-stops.html#cb51-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb51-4"><a href="traffic-stops.html#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="traffic-stops.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="traffic-stops.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="traffic-stops.html#cb51-7" aria-hidden="true" tabindex="-1"></a>key <span class="kw">variable</span> student is str1 <span class="kw">in</span> master but <span class="kw">float</span> <span class="kw">in</span> <span class="kw">using</span></span>
<span id="cb51-8"><a href="traffic-stops.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">data</span></span>
<span id="cb51-9"><a href="traffic-stops.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    Each key <span class="kw">variable</span> -- the variables <span class="kw">on</span> which</span>
<span id="cb51-10"><a href="traffic-stops.html#cb51-10" aria-hidden="true" tabindex="-1"></a>    observations are matched -- must <span class="kw">be</span> <span class="kw">of</span> the same</span>
<span id="cb51-11"><a href="traffic-stops.html#cb51-11" aria-hidden="true" tabindex="-1"></a>    generic <span class="dv">type</span> <span class="kw">in</span> the master and <span class="kw">using</span> datasets.  Same</span>
<span id="cb51-12"><a href="traffic-stops.html#cb51-12" aria-hidden="true" tabindex="-1"></a>    generic <span class="dv">type</span> <span class="kw">means</span> both <span class="kw">numeric</span> <span class="kw">or</span> both <span class="fu">string</span>.</span>
<span id="cb51-13"><a href="traffic-stops.html#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(106);</span>
<span id="cb51-14"><a href="traffic-stops.html#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="traffic-stops.html#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">of</span> <span class="kw">do</span>-file</span>
<span id="cb51-16"><a href="traffic-stops.html#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(106);</span></code></pre></div>
<p>This error code is describing how the format of the variables is different in our master vs. using dataset. To fix this issue, we need to convert one of the variable formats. For example, we could type <code>destring student, replace</code> to convert the student variable to a numeric variable in the <code>test_score3.dta</code> dataset.</p>
<p>Lastly, we have discussed one-to-one merges, many-to-one merges and one-to-many merges, but what about many-to-many merges? The reason we have not discussed it is because <strong>you should never do many-to-many merges in Stata</strong>. In most cases, the right way to proceed if you find yourself faced with a many-to-many merge is to restructure your data. Usually you can use some data wrangling (like <code>collapse</code>) to transform your data into a one-to-one, many-to-one or one-to-many merge. There is a command <code>joinby</code> that does accomplish something like a many-to-many merge, but we will not discuss this command in this book.</p>
</div>
<div id="build-data" class="section level2" number="3.8">
<h2>
<span class="header-section-number">3.8</span> Build Data<a class="anchor" aria-label="anchor" href="#build-data"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we understand the merge command, let’s use it to merge traffic stop data to data on sunset times so that we can implement the veil of darkness test. To remind you, to apply the veil of darkness test we are going to look at the time period 6:30-7:00 PM.Sometimes it is dark out at 6:30-7:00 PM, sometimes it is light. We need to identify whether it was light or dark for every stop in our data.</p>
<p>The problem, however, is that our data for stops currently comes in two separate files, one for the years 2014-2015 and one for the years 2016-2017. Additionally, our sunset data comes in a separate file. Therefore, we have three separate files that we need to combine to create one final dataset.</p>
<p>To create a dataset of all stops between 2014-2017, we need to <code>append</code> the stop-level data.</p>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...


/Users/davidarnold/Dropbox/Teaching/EP5/online/03_week/data</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb53-1"><a href="traffic-stops.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> san_diego_stops_2014_2015.dta, <span class="kw">clear</span></span>
<span id="cb53-2"><a href="traffic-stops.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> san_diego_stops_2016_2017.dta</span>
<span id="cb53-3"><a href="traffic-stops.html#cb53-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<p>So it might look as if nothing happened in Stata. To check that we now have all years of data in a single dataset we can type:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb54-1"><a href="traffic-stops.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> <span class="fu">year</span></span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2014 |    138,735       36.40       36.40
       2015 |    112,201       29.44       65.84
       2016 |    102,181       26.81       92.65
       2017 |     28,032        7.35      100.00
------------+-----------------------------------
      Total |    381,149      100.00</code></pre>
<p>Now we have verified that the current data in memory has stops between 2014-2017. Our next task is to <code>merge</code> in the data on sunset times. To do this, we need to make sure of two things. First, is there a variable that we can merge on? In general, you would need to load both datasets and check if there are any variables that store the same information. In our case, there is a single variable that meets this criteria: <code>date</code>. Second, is this a one-to-one or many-to-one merge? Third, is the <code>date</code> variable in both datasets stored in the same format?</p>
<p>To get started, we need to figure out how many observations there are for a given <code>date</code> in each dataset. Intuitively, we expect there are multiple observations per <code>date</code> in the traffic stop date. In other words, officers stop more than one individual per day. In the sunset data, well there is only a single sunset time for every day, so we expect a single observation per <code>date</code>. But data is not always stored how we expect, so it is always good to check this. The way were are going to check is through the <code>unique</code> command.</p>
<p>The <code>unique</code> command does not come installed in Stata. You need to install it into your version of Stata by typing <code>ssc install unique</code> into the Command window. In general, you might find a command online that will help you perform some data analysis. Many commands can be installed by typing <code>ssc install commandname</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb56-1"><a href="traffic-stops.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">unique</span> <span class="fu">date</span></span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...


Number of unique values of date is  1186
Number of records is  381149</code></pre>
<p>How do we interpret this output? Well, the number of unique values of date is 1186. In other words, this is how many different days there are in our dataset on traffic stops. In contrast, there are 381,149 total stops. Therefore, there are multiple stops per day. Whenever you see more records than unique values, you know this is a <code>many-to-BLANK</code> merge. The next job for us is to figure out if the <code>BLANK</code> should be replaced by a <code>one</code>. In order to do this we need to load the <code>sd_sunset.dta</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb58-1"><a href="traffic-stops.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> sd_sunset.dta, <span class="kw">clear</span></span>
<span id="cb58-2"><a href="traffic-stops.html#cb58-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb59-1"><a href="traffic-stops.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">unique</span> <span class="fu">date</span></span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...


Number of unique values of date is  1186
Number of records is  1186</code></pre>
<p>In this dataset, there are 1186 unique values of date, and 1186 records. Therefore, each value of date is a unique observation in the dataset. Therefore, we can conclude that this is a <code>many-to-one</code> merge. There are many observations per value of <code>date</code> in the stops data, but one observation per value of <code>date</code> in the sunset data.</p>
<p>The last thing we need to do is to check that the format of the date variable is the same in both datasets. Let’s look at the first observation in the <code>sd_sunset.dta</code></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb61-1"><a href="traffic-stops.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="fu">date</span> <span class="kw">if</span> <span class="dt">_n</span>==1</span>
<span id="cb61-2"><a href="traffic-stops.html#cb61-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb61-3"><a href="traffic-stops.html#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="traffic-stops.html#cb61-4" aria-hidden="true" tabindex="-1"></a>      +-----------+</span>
<span id="cb61-5"><a href="traffic-stops.html#cb61-5" aria-hidden="true" tabindex="-1"></a>      |      <span class="fu">date</span> |</span>
<span id="cb61-6"><a href="traffic-stops.html#cb61-6" aria-hidden="true" tabindex="-1"></a>      |-----------|</span>
<span id="cb61-7"><a href="traffic-stops.html#cb61-7" aria-hidden="true" tabindex="-1"></a>   1. | 01jan2014 |</span>
<span id="cb61-8"><a href="traffic-stops.html#cb61-8" aria-hidden="true" tabindex="-1"></a>      +-----------+</span></code></pre></div>
<p>Now, let’s go back to the stop-level data and check if <code>date</code> is held in the same format.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb62-1"><a href="traffic-stops.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> san_diego_stops_2014_2015.dta, <span class="kw">clear</span></span>
<span id="cb62-2"><a href="traffic-stops.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> san_diego_stops_2016_2017.dta</span>
<span id="cb62-3"><a href="traffic-stops.html#cb62-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb63-1"><a href="traffic-stops.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="fu">date</span> <span class="kw">if</span> <span class="dt">_n</span>==1</span>
<span id="cb63-2"><a href="traffic-stops.html#cb63-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb63-3"><a href="traffic-stops.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="traffic-stops.html#cb63-4" aria-hidden="true" tabindex="-1"></a>        +-----------+</span>
<span id="cb63-5"><a href="traffic-stops.html#cb63-5" aria-hidden="true" tabindex="-1"></a>        |      <span class="fu">date</span> |</span>
<span id="cb63-6"><a href="traffic-stops.html#cb63-6" aria-hidden="true" tabindex="-1"></a>        |-----------|</span>
<span id="cb63-7"><a href="traffic-stops.html#cb63-7" aria-hidden="true" tabindex="-1"></a>     1. | 01jan2014 |</span>
<span id="cb63-8"><a href="traffic-stops.html#cb63-8" aria-hidden="true" tabindex="-1"></a>        +-----------+</span></code></pre></div>
<p>It looks like the <code>date</code> variable is in the same format. If it is not, you then will need to do some data wrangling in order to get it into the same format. For us, we can now merge this data to the sunset data:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb64-1"><a href="traffic-stops.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 <span class="fu">date</span> <span class="kw">using</span> sd_sunset.dta, <span class="kw">keep</span>(3) nogen</span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           381,149  
    -----------------------------------------</code></pre>
<p>We are going to want to use this data for our analysis later, so we can save the combined dataset under a new name: <code>sd_analysis_sample.dta</code> by typing:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb66-1"><a href="traffic-stops.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> sd_analysis_sample.dta, <span class="kw">replace</span> </span></code></pre></div>
<p>This code will place a new file in your working directory named <code>sd_analysis_sample.dta</code>. Next time you want to work with your data, you can now load this file directly, and won’t need to repeat the steps of appending and merging datasets together.</p>
</div>
<div id="date-time" class="section level2" number="3.9">
<h2>
<span class="header-section-number">3.9</span> Date-Time<a class="anchor" aria-label="anchor" href="#date-time"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have all the information to perform the veil of darkness test, we need to restrict to stops for which the test applies. To remind you, we will explore whether the composition of trafic stops by race varies by whether it is light or dark out, controlling for the time of the stop.</p>
<p>In order to do this, we will restrict to traffic stops that occur between 6:30-7:00 PM. In San Diego, in parts of the year, it is dark out at 6:30-7:00 PM. At other times it is light out. This is, of course, not the only time slot that will work. In fact, the methods in Grogger and Ridgeway (2006) use all such times that are sometimes light and sometimes dark. Performing this analysis requires statistical techniques beyond the level of this class, so we will instead focus on one particular block of time: 6:30-7:00 PM.</p>
<p>So we need to restrict to all stops that occur in this time period. Doing this will be harder than you think! We need to learn how Stata stores the time of the day.</p>
<p>In Stata, times of the day are often held in terms of milliseconds from midnight. Why? Well, you could store it as a string variables, but you can’t add string variables. For example, while I understand that the string <code>"6:00 PM"</code> is equal to 6:00 PM at night, I need a way to store the information so that I can do things like add or subtract additional time (i.e. if I add an hour to 6:00 PM the result should be 7:00 PM). Strings are interpreted as words in Stata and so cannot be added in this way.</p>
<p>To see how Stata stores times, we can <code>summarize</code> our variable <code>stop_time</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb67-1"><a href="traffic-stops.html#cb67-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">use</span> sd_analysis_sample.dta, <span class="kw">replace</span></span>
<span id="cb67-2"><a href="traffic-stops.html#cb67-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb68-1"><a href="traffic-stops.html#cb68-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sum</span> stop_time </span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

    Variable |        Obs        Mean    Std. dev.       Min
&gt;         Max
-------------+----------------------------------------------
&gt; -----------
   stop_time |    381,149    4.70e+07    2.26e+07          0
&gt;    8.63e+07</code></pre>
<p>It is stored in terms of milliseconds from midnight (so 0 is midnight exactly and 1 hour later (1:00 AM) would be <span class="math inline">\(60\cdot 60 \cdot 1000 = 3,600,000\)</span>). So how many milliseconds to 6:30 PM?</p>
<p><span class="math display">\[
\underbrace{18}_{\text{hours}} \cdot \underbrace{3,600,000}_{\text{ms per hour}} + \underbrace{1,800,000}_{\text{ms per half hour}}=66,600,000
\]</span>
So if we are restricting to 6:30 PM to 7:00 PM, we should restrict to all stops with values of <code>stop_time</code> between 66,600,000 and So we should restrict to stops that happen in the range 68,400,000.</p>
<p>While this procedure will get you the right answer, typing some large numbers can sometimes lead to transcription errors if you are not careful. A better way to do this is to use Stata commands that do this math for you. The <code>clock()</code> command automatically translates time as we usually interpret it (i.e. 9:00 AM) into milliseconds from midnight automatically.</p>
<p>For example, to see how many milliseconds from midnight 6:00 PM is type:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb70-1"><a href="traffic-stops.html#cb70-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">di</span> clock(<span class="st">"18:30:00"</span>,<span class="st">"hms"</span>)</span>
<span id="cb70-2"><a href="traffic-stops.html#cb70-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb70-3"><a href="traffic-stops.html#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="traffic-stops.html#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="traffic-stops.html#cb70-5" aria-hidden="true" tabindex="-1"></a>66600000</span></code></pre></div>
<p>Where <code>18:30:00"</code> is 6:30 PM on a 24-hour clock. <code>"hms"</code> tells Stata that time should be interpreted as hours, minutes, seconds. Now that we understand how to use the <code>clock</code> command, we can use it to restrict to stops that occurred between 6:30 PM and 7:00 PM:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb71-1"><a href="traffic-stops.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> stop_time&lt;clock(<span class="st">"18:30:00"</span>,<span class="st">"hms"</span>)</span>
<span id="cb71-2"><a href="traffic-stops.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> stop_time&gt;clock(<span class="st">"19:00:00"</span>,<span class="st">"hms"</span>) </span>
<span id="cb71-3"><a href="traffic-stops.html#cb71-3" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb71-4"><a href="traffic-stops.html#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="traffic-stops.html#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="traffic-stops.html#cb71-6" aria-hidden="true" tabindex="-1"></a>(296,355 observations deleted)</span>
<span id="cb71-7"><a href="traffic-stops.html#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="traffic-stops.html#cb71-8" aria-hidden="true" tabindex="-1"></a>(76,052 observations deleted)</span></code></pre></div>
<p>Next, we need to generate indicators that tell us whether a given stop occurred during sunlight or in the dark. We will define a traffic stop occurring in the sunlight if it occurs before sunset. The variable <code>sunset</code> in the data contains the time of the sunset, which we can compare to the <code>stop_time</code> to generate an indicator for <code>light</code>:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb72-1"><a href="traffic-stops.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> light = (stop_time&lt;sunset)</span>
<span id="cb72-2"><a href="traffic-stops.html#cb72-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<p>We will define a traffic stop occurring in the dark if it occurs after dusk (dusk is about 30 minutes after sunset). The variable <code>dusk</code> in the data contains the time of dusk, which we can compare to the <code>stop_time</code> to generate an indicator for <code>dark</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb73-1"><a href="traffic-stops.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> dark = (stop_time&gt;dusk)</span>
<span id="cb73-2"><a href="traffic-stops.html#cb73-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span></code></pre></div>
<p>Now, there are some stops that occur between sunset and dusk. For these stops, we aren’t sure if driver race is observed. It is neither light or dark at these times (i.e. <code>dark==0 &amp; light==0</code>). We are going to drop these stops from the analysis:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb74-1"><a href="traffic-stops.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> light==0 &amp; dark==0 </span>
<span id="cb74-2"><a href="traffic-stops.html#cb74-2" aria-hidden="true" tabindex="-1"></a>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/<span class="kw">p</span>&gt; ile.<span class="kw">do</span> ...</span>
<span id="cb74-3"><a href="traffic-stops.html#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="traffic-stops.html#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="traffic-stops.html#cb74-5" aria-hidden="true" tabindex="-1"></a>(414 observations deleted)</span></code></pre></div>
<p>Now we are ready to start our analysis to implement the veil of darkness.</p>
</div>
<div id="implement-vod" class="section level2" number="3.10">
<h2>
<span class="header-section-number">3.10</span> Implement VOD<a class="anchor" aria-label="anchor" href="#implement-vod"><i class="fas fa-link"></i></a>
</h2>
<p>We need to compare the composition of traffic stops in times of sunlight vs. darkness to implement the veil of darkness test. If stop rates for minorities drop after dark, that indicates they were being targeted in the sunlight. To retrieve the composition of traffic stops by race, we can use the <code>tab</code> command:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb75-1"><a href="traffic-stops.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> subject_race </span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

          subject_race |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Asian/Pacific Islander |        747        8.97        8.97
                 Black |      1,084       13.02       21.99
              Hispanic |      2,847       34.19       56.17
                 Other |        561        6.74       62.91
                 White |      3,089       37.09      100.00
-----------------------+-----------------------------------
                 Total |      8,328      100.00</code></pre>
<p>If we want the composition, but restrict to stops in the sunlight, we can add a conditional statement to our code:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb77-1"><a href="traffic-stops.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> subject_race <span class="kw">if</span> dark==0 </span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

          subject_race |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Asian/Pacific Islander |        375        8.40        8.40
                 Black |        589       13.20       21.60
              Hispanic |      1,528       34.24       55.84
                 Other |        319        7.15       62.98
                 White |      1,652       37.02      100.00
-----------------------+-----------------------------------
                 Total |      4,463      100.00</code></pre>
<p>Now let’s look at the composition of traffic stops in the dark:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb79-1"><a href="traffic-stops.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> subject_race <span class="kw">if</span> dark==1 </span></code></pre></div>
<pre><code>Running /Users/davidarnold/Dropbox/Teaching/EP5Bookdown/p&gt; ile.do ...

          subject_race |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Asian/Pacific Islander |        372        9.62        9.62
                 Black |        495       12.81       22.43
              Hispanic |      1,319       34.13       56.56
                 Other |        242        6.26       62.82
                 White |      1,437       37.18      100.00
-----------------------+-----------------------------------
                 Total |      3,865      100.00</code></pre>
<p>In these tables, we are trying to see if certain races are much less likely to be stopped in darkness relative to sunlight. If this is true, then this is good evidence that this race is being targeted during sunlight hours. From the table above, the composition of traffic stops seems relatively similar during sunlight vs. after dark. However, it is a little difficult to absorb all the information from these multiple tables. To really get the information across, it might be useful to put this information into a figure.</p>
</div>
<div id="bar-graphs" class="section level2" number="3.11">
<h2>
<span class="header-section-number">3.11</span> Bar Graphs<a class="anchor" aria-label="anchor" href="#bar-graphs"><i class="fas fa-link"></i></a>
</h2>
<p>Eventually, we are going to use a bar graph to visualize the veil of darkness test for discrimination. In this chapter, we are going to learn how to construct bar graphs in Stata generally. To begin, we are going to set up a hypothetical example. Imagine we are trying to construct a bar graph that shows average GPA across different schools, based on the data below:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:schoolgpa"></span>
<img src="images/03_school_gpa.png" alt="Dataset on Schools and GPA" width="65%"><p class="caption">
Figure 3.15: Dataset on Schools and GPA
</p>
</div>
<p>The command <code>graph bar</code> is used to make bar graphs in Stata. There are lots of ways this command can be altered, so make sure to look at the help file! To start, we are going to create a bar graph that shows average GPA for each school.</p>
<p>The basic syntax for the <code>graph bar</code> command is</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb81-1"><a href="traffic-stops.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> (stat) yvar, <span class="bn">over</span>(xvar)</span></code></pre></div>
<p><code>(stat)</code> will be <code>(mean)</code> if you want the average value of the y-variable to be displayed. There are also other options in the help file. For example, you could have the command plot the count, the minimum, maximum, median, among other statistics. <code><a href="https://rdrr.io/r/grDevices/plotmath.html">over(xvar)</a></code> will be the variable that defines the groups on the horizontal axis.</p>
<p>In our example, we want the average of the variable <code>gpa</code>, so we will type <code>(mean) gpa</code>. What do want the average over? The class variable. So we will type <code><a href="https://rdrr.io/r/grDevices/plotmath.html">over(class)</a></code>. All together:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb82-1"><a href="traffic-stops.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> (<span class="kw">mean</span>) gpa, <span class="bn">over</span>(school)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:barex"></span>
<img src="images/03_bar_ex.png" alt="Simple Bar Graph" width="65%"><p class="caption">
Figure 3.16: Simple Bar Graph
</p>
</div>
<p>As always need descriptive titles and properly labeled axes. We can add these the same way we added them for histograms:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb83-1"><a href="traffic-stops.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> (<span class="kw">mean</span>) gpa, <span class="bn">over</span>(school) <span class="co">///</span></span>
<span id="cb83-2"><a href="traffic-stops.html#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="bn">title</span>(<span class="st">"Average GPA by Classroom"</span>) <span class="co">///</span></span>
<span id="cb83-3"><a href="traffic-stops.html#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ytitle</span>(<span class="st">"Average GPA"</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:barex2"></span>
<img src="images/03_bar_ex2.png" alt="Simple Bar Graph with Titles/Labels" width="65%"><p class="caption">
Figure 3.17: Simple Bar Graph with Titles/Labels
</p>
</div>
<p>Sometimes we need to change the aesthetics of our figures to make them more easily readable. One external package I find useful to install is <code>blindschemes</code>, which provides color schemes for Stata graphs that are distinguishable for individuals that are color blind. To install blindschemes type:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb84-1"><a href="traffic-stops.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install blindschemes</span></code></pre></div>
<p><code>blindschemes</code> comes with a number of different <code>schemes</code>. You can think of graphics schemes as capturing the overall theme or aesthetic of your graph. Let’s set the <code>scheme</code> to <code>plotplainblind</code>, which is one of the schemes that comes from the <code>blindschemes</code> package.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb85-1"><a href="traffic-stops.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">scheme</span> plotplainblind</span></code></pre></div>
<p>Now we can re-run the exact same code as before, but the overall aesthetic will be different. This is because we have changed the scheme of the graph.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb86-1"><a href="traffic-stops.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> (<span class="kw">mean</span>) gpa, <span class="bn">over</span>(school) <span class="co">///</span></span>
<span id="cb86-2"><a href="traffic-stops.html#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="bn">title</span>(<span class="st">"Average GPA by Classroom"</span>) <span class="co">///</span></span>
<span id="cb86-3"><a href="traffic-stops.html#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ytitle</span>(<span class="st">"Average GPA"</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:barex3"></span>
<img src="images/03_bar_ex3.png" alt="Simple Bar Graph with Titles/Labels" width="65%"><p class="caption">
Figure 3.18: Simple Bar Graph with Titles/Labels
</p>
</div>
<p>There are many further options when constructing bar graphs. Sometimes, the option you are looking for isn’t available, but there are still ways to construct the required bar graph. In other words, you may need to use some <strong>data wrangling</strong> to get your data in the right format to construct a bar graph. In the next section we will learn another data wrangling technique that is generally useful, but will be particularly useful for generating the bar graph to visualize the veil of darkness test.</p>
</div>
<div id="collapse" class="section level2" number="3.12">
<h2>
<span class="header-section-number">3.12</span> Collapse<a class="anchor" aria-label="anchor" href="#collapse"><i class="fas fa-link"></i></a>
</h2>
<p><code>Collapse</code> transforms your data to a different unit of analysis. Why is this useful? Imagine you have individual-level data on income, but you only care about average income by state for your analysis. The <code>collapse</code> command will allow you to quickly transform your data to the state level. Imagine you want to understand averages of a variable over the years. Collapsing the data to the year level can be a quick way to understand how the variable is changing over time.</p>
<p>The basic syntax of the <code>collapse</code> command is</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb87-1"><a href="traffic-stops.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (stat) varlist1, <span class="kw">by</span>(varlist2)</span></code></pre></div>
<p><code>(stat)</code> will be some statistic. The default is the mean. We will also use <code>count</code> later in this chapter. <code>varlist1</code> is a variable (or list of variables) that you would like to retrieve the mean for. <code>varlist2</code> is a variable (or list of variables) will define the groups over which the statistic is calculated.</p>
To practice with this command, consider the (fake) dataset below:
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:wages"></span>
<img src="images/03_wages.png" alt="Wages for Workers in Different States" width="65%"><p class="caption">
Figure 3.19: Wages for Workers in Different States
</p>
</div>
<p>Our goal now is to transform this dataset into a dataset with just two observations: one for “CA” and one for “AZ”. In terms of variables, we want two variables, one that contains the average weekly income and one that contains the average age. In other words, we are taking a dataset that is currently at the worker level and collapsing it to a dataset that is at the state level. To do this in Stata we type:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb88-1"><a href="traffic-stops.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="kw">mean</span>) weekly_income age, <span class="kw">by</span>(state)</span></code></pre></div>
<p>The collapsed dataset is depicted in Figure <a href="traffic-stops.html#fig:collapsed">3.20</a></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:collapsed"></span>
<img src="images/03_wages2.png" alt="Collapsed State-level Dataset" width="65%"><p class="caption">
Figure 3.20: Collapsed State-level Dataset
</p>
</div>
<p>One important note is that in order to retrieve the original dataset, you would need to re-load it into Stata. There is no simple “undo” button that gets you back to the original worker-level dataset.</p>
</div>
<div id="visualizing-veil-of-darkness" class="section level2" number="3.13">
<h2>
<span class="header-section-number">3.13</span> Visualizing Veil of Darkness<a class="anchor" aria-label="anchor" href="#visualizing-veil-of-darkness"><i class="fas fa-link"></i></a>
</h2>
<p>In this section, we want to construct a data visualization that will allow us to see clearly the results of the veil of darkness test. Let’s look at some hypothetical examples before we begin so that we know what our end goal should look like. Figure <a href="traffic-stops.html#fig:veilhyp1">3.21</a> presents a hypothetical example of what our results could look like.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:veilhyp1"></span>
<img src="images/03_ill_ex1.png" alt="Veil of Darkness Test Finds Discriminatory Policy Behavior" width="65%"><p class="caption">
Figure 3.21: Veil of Darkness Test Finds Discriminatory Policy Behavior
</p>
</div>
<p>Is this evidence of discriminatory behavior or not? In this case, the answer is yes. When it is light out, 60 percent of stopped drivers are Black. When it is dark out, this falls to 50 percent. The fall in fraction of stops for Black drivers in the darkness could be explained by discriminatory officers being unable to observe race in the dark, and thus, unable to target minority drivers for stops.</p>
<p>Figure <a href="traffic-stops.html#fig:veilhyp2">3.22</a> presents a different hypothetical example of what our results could look like.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:veilhyp2"></span>
<img src="images/03_ill_ex1.png" alt="Veil of Darkness Test Finds No Evidence of Discriminatory Policy Behavior" width="65%"><p class="caption">
Figure 3.22: Veil of Darkness Test Finds No Evidence of Discriminatory Policy Behavior
</p>
</div>
<p>Is this evidence of discriminatory behavior or not? In this case, the answer is no. When it is light out, 50 percent of stopped drivers are Black. When it is dark out, this remains steady at 50 percent. It does not appear in this data that officers are targeting minority drivers.</p>
<p>Starting where we left off, we have now constructed a dataset with (1) traffic stops that occur between 6:30-7:00 PM, and (2) indicators for whether there was sunlight (<code>dark==0</code>) or darkness (<code>dark==1</code>). We can use this data to generate a similar visualization as the graphs above.</p>
<p>We need to compare the composition of traffic stops in times of sunlight vs. darkness. We can use the <code>collapse</code> command to create a dataset of these statistics. To start, let’s create a dataset that has the number of stops by race, for both daylight and darkness</p>
<p>To count the number of observations per race for both daylight and darkness, we can use the <code>count</code> option of the collapse command. This option will count the number of observations with non-missing values of a variable. To begin, let’s create a variable (that will eventually store our counts) that is non-missing for all observations.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb89-1"><a href="traffic-stops.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> obs_count = 1</span></code></pre></div>
<p>Now we can collapse the data to the subject-race-by-dark condition level:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb90-1"><a href="traffic-stops.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="fu">count</span>) obs_count, <span class="kw">by</span>(subject_race dark) </span></code></pre></div>
<p>When we specify two variables in <code>by</code>, the resulting dataset includes an observation for every unique combination of the two variables. In our dataset, there are 5 different values of the <code>race</code> variable, while there are 2 different values of our <code>dark</code> variable. The resulting dataset in this case will have 10 observations. Each row will correspond to a given race in a given light condition.</p>
<p>Figure <a href="traffic-stops.html#fig:br1">3.23</a> displays the resulting collapsed dataset. As you can see, for each race and light condition, we now have the total number of stops that occurred for that race, within the given light condition. For example, the first row here indicates that in our dataset, there are 375 stops for Asian/Pacific Islanders when it is between 6:30-7:00 PM and light out (i.e. <code>dark==0</code>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:br1"></span>
<img src="images/03_br1.png" alt="Collapsed Dataset" width="65%"><p class="caption">
Figure 3.23: Collapsed Dataset
</p>
</div>
<p>In our plot, however, we want to plot the fraction of stops for each race by light condition. This is a pretty small dataset, so we could do this manually. For example, what fraction of stops when it is light out are for Asian/Pacific Islanders. Based on <a href="traffic-stops.html#fig:br1">3.23</a>, we know that this equal to:</p>
<p><span class="math display">\[
\frac{\text{Stops for Asian/Pacific Islander When Light}}{\text{Stops When Light}} = \frac{375}{375+589+1528+319+1652} =  0.084
\]</span>
But what if we had more observations. Also, we need these values in our dataset. It will be easier if we can add a variable to the dataset that contains this information. We are going to do this in two steps. First, we are going to create a variable that contains the total stops within a given light condition. Then, we are going to generate the variable we want by dividing <code>obs_count</code> by this new variable.</p>
<p>To create this new variable we are going to use the <code>egen</code> command. <code>egen</code> stands for extensions to generate, and is very useful when trying to create more variables. If you ever want to create a variable, but can’t figure out exactly how, type <code>help egen</code> to see if it is possible with the egen command.</p>
<p>First, let’s present the code for calculating total stops by light condition:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb91-1"><a href="traffic-stops.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> dark: <span class="kw">egen</span> total_stops = <span class="kw">total</span>(obs_count)</span></code></pre></div>
<p><code>bysort dark:</code> tells Stata that any code that comes after the <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> should be done separately for values of the <code>dark</code> variable. <code>egen total_stops = total(obs_count)</code> will create a new variable that is equal to the sum total of the variable <code>obs_count</code>. In simple terms, the total number of stops in daylight and darkness.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:br1p5"></span>
<img src="images/03_br1p5.png" alt="Collapsed Dataset with Total Stops by Light Condition" width="65%"><p class="caption">
Figure 3.24: Collapsed Dataset with Total Stops by Light Condition
</p>
</div>
<p>Now that we have (1) total stops by race in daylight vs. darkness and (2) total stops overall in daylight vs. darkness we can create our required variables</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb92-1"><a href="traffic-stops.html#cb92-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> fraction_stops = obs_count/total_stops</span></code></pre></div>
<p>Now we can use this variable to show the composition of traffic stops (by race) both in the daylight and darkness:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb93-1"><a href="traffic-stops.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> fraction_stops, <span class="bn">over</span>(dark) <span class="bn">over</span>(subject_race)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bar1"></span>
<img src="images/03_bar1.png" alt="Fraction of Stops by Race and Light Condition" width="65%"><p class="caption">
Figure 3.25: Fraction of Stops by Race and Light Condition
</p>
</div>
<p>This is a good start. It has all the information we need. The next section will introduce a few things to improve the data visualization of this information.</p>
</div>
<div id="improving-aesthetics" class="section level2" number="3.14">
<h2>
<span class="header-section-number">3.14</span> Improving Aesthetics<a class="anchor" aria-label="anchor" href="#improving-aesthetics"><i class="fas fa-link"></i></a>
</h2>
<p>As always, the first task is to add some descriptive titles and labels:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb94-1"><a href="traffic-stops.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> fraction, <span class="bn">over</span>(dark) <span class="bn">over</span>(subject_race) <span class="co">///</span></span>
<span id="cb94-2"><a href="traffic-stops.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="bn">title</span>(<span class="st">"Composition of Traffic Stops by Light Conditions"</span>) <span class="co">///</span></span>
<span id="cb94-3"><a href="traffic-stops.html#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ytitle</span>(<span class="st">"Fraction of All Stops"</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bar2"></span>
<img src="images/03_bar2.png" alt="Fraction of Stops by Race and Light Condition" width="65%"><p class="caption">
Figure 3.26: Fraction of Stops by Race and Light Condition
</p>
</div>
<p>Because we generated this data, we know <code>dark==0</code> represents daylight and <code>dark==1</code> represents darkness, but our reader won’t. We need to relabel the zero to light and the 1 to dark so that a reader will understand what the graph represents. To do this, we can use the <code>relabel</code> option:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb95-1"><a href="traffic-stops.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> fraction, <span class="co">///</span></span>
<span id="cb95-2"><a href="traffic-stops.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="bn">over</span>(dark,relabel(1 <span class="st">"Light"</span> 2 <span class="st">"Dark"</span>)) <span class="bn">over</span>(subject_race) <span class="co">///</span></span>
<span id="cb95-3"><a href="traffic-stops.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="bn">title</span>(<span class="st">"Composition of Traffic Stops by Light Conditions"</span>) <span class="co">///</span></span>
<span id="cb95-4"><a href="traffic-stops.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="bn">ytitle</span>(<span class="st">"Fraction of All Stops"</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bar3"></span>
<img src="images/03_bar3.png" alt="Fraction of Stops by Race and Light Condition" width="65%"><p class="caption">
Figure 3.27: Fraction of Stops by Race and Light Condition
</p>
</div>
<p>I don’t expect you will need this next option too often. The option <code>asyvars</code> treats the first <code><a href="https://rdrr.io/r/grDevices/plotmath.html">over()</a></code> groups as a y-variable. In our case this will make the <code>Light</code> and <code>Dark</code> labels will appear in a legend instead of on the x-axis. This will make the graph look a little cleaner and easier to interpret quickly:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb96-1"><a href="traffic-stops.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> fraction, asyvars <span class="co">///</span></span>
<span id="cb96-2"><a href="traffic-stops.html#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="bn">over</span>(dark,relabel(1 <span class="st">"Light"</span> 2 <span class="st">"Dark"</span>)) <span class="bn">over</span>(subject_race) <span class="co">///</span></span>
<span id="cb96-3"><a href="traffic-stops.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="bn">title</span>(<span class="st">"Composition of Traffic Stops by Light Conditions"</span>) <span class="co">///</span></span>
<span id="cb96-4"><a href="traffic-stops.html#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="bn">ytitle</span>(<span class="st">"Fraction of All Stops"</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bar4"></span>
<img src="images/03_bar4.png" alt="Fraction of Stops by Race and Light Condition" width="65%"><p class="caption">
Figure 3.28: Fraction of Stops by Race and Light Condition
</p>
</div>
<p>The last step is we can change the colors of the bars:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb97-1"><a href="traffic-stops.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">bar</span> fraction, asyvars <span class="co">///</span></span>
<span id="cb97-2"><a href="traffic-stops.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="bn">over</span>(dark,relabel(1 <span class="st">"Light"</span> 2 <span class="st">"Dark"</span>)) <span class="bn">over</span>(subject_race) <span class="co">///</span></span>
<span id="cb97-3"><a href="traffic-stops.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="bn">title</span>(<span class="st">"Composition of Traffic Stops by Light Conditions"</span>) <span class="co">///</span></span>
<span id="cb97-4"><a href="traffic-stops.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="bn">ytitle</span>(<span class="st">"Fraction of All Stops"</span>) <span class="co">///</span></span>
<span id="cb97-5"><a href="traffic-stops.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="bn">bar</span>(1, fcolor(sky)) <span class="co">///</span></span>
<span id="cb97-6"><a href="traffic-stops.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="bn">bar</span>(2, fcolor(vermillion))</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bar5"></span>
<img src="images/03_bar5.png" alt="Fraction of Stops by Race and Light Condition" width="65%"><p class="caption">
Figure 3.29: Fraction of Stops by Race and Light Condition
</p>
</div>
<p>So now let’s spend a little time interpreting our main result. Overall, it appears that the fraction of stops for a given race does not depend dramatically on the light condition. We can see this is in the graph by the fact that the blue and orange bars tend to be around the same height. If the orange bar (i.e. <code>dark==1</code>) was dramatically lower for some races, then that would be evidence that police were targeting this race in the daylight.</p>
<p>Like any empirical design, the test has assumptions and limitations. It is not a fatal flaw that a given set of research has limitations. All research has limitations and it is important to think carefully about them. In the next section we will discuss some of these limtations, as well as feature some other factors that could be studied with the Stanford Open Policing Project data.</p>
</div>
<div id="conclusion-1" class="section level2" number="3.15">
<h2>
<span class="header-section-number">3.15</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-1"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s discuss a few of the implicit assumptions in the veil of darkness test. First, we assumed driver race is unobservable after dusk. But what about artificial lighting, like street lamps? If in certain areas officers can detect race, then this method will underestimate level of discrimination. In other words, if driver race is observed in both sunlight and darkness, then the logic of the test as a method to identify discrimination no longer holds.</p>
<p>Another assumption is that driving behavior is the same before and after dark. What if minority drivers adjust their driving behavior because of potential racial profiling in daylight? Kalinowski, Ross, and Ross (2021)<span class="citation"><a href="references-1.html#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></span> find evidence that this is true in certain areas.</p>
<p>This data has a lot of possibilities and we have explored only a small portion of it. In this final section let’s think about a few more possible questions to explore.</p>
<p>First, we have focused on one place: San Diego. But we can look at how this test finds different results across different areas. If we find different results, we can ask why? What factors predict high levels of discriminatory behavior. Are there policies that could be used to reduce discriminatory behavior?</p>
<p>Second, we have focused on the initial decision to stop a driver. There could be discrimination at other stages of the stop. For example, are police officers more likely to search for contraband if the driver is a minority? This is something the researchers at the Stanford Open Policing Project have explored. Below is a figure from the SOPP website that shows search rates by race across different U.S.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:searchrates"></span>
<img src="images/03_search_rates.png" alt="Disparities in Search Rates Across U.S. Cities" width="65%"><p class="caption">
Figure 3.30: Disparities in Search Rates Across U.S. Cities
</p>
</div>
<p>As can be seen in Figure <a href="traffic-stops.html#fig:searchrates">3.30</a>, the search rates tend to be higher for Black and Hispanic drivers across most cities in the U.S.</p>
<p>This still just scratches the surface of what can be done with this data! The main takeaway from this chapter: data can be a powerful tool that informs policy. The Stanford Open Policing Project is one effort to improve transparency in policing by making data publicly available to researchers and journalists.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="intergenerational-mobility.html"><span class="header-section-number">2</span> Intergenerational Mobility</a></div>
<div class="next"><a href="classroom-technology.html"><span class="header-section-number">4</span> Classroom Technology</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#traffic-stops"><span class="header-section-number">3</span> Traffic Stops</a></li>
<li><a class="nav-link" href="#sopp-intro"><span class="header-section-number">3.1</span> SOPP Intro</a></li>
<li><a class="nav-link" href="#sopp-data"><span class="header-section-number">3.2</span> SOPP Data</a></li>
<li><a class="nav-link" href="#veil-of-darkness-vod"><span class="header-section-number">3.3</span> Veil of Darkness (VOD)</a></li>
<li><a class="nav-link" href="#data-wrangling"><span class="header-section-number">3.4</span> Data Wrangling</a></li>
<li><a class="nav-link" href="#append"><span class="header-section-number">3.5</span> Append</a></li>
<li><a class="nav-link" href="#merge-basics"><span class="header-section-number">3.6</span> Merge Basics</a></li>
<li><a class="nav-link" href="#merge-advanced"><span class="header-section-number">3.7</span> Merge Advanced</a></li>
<li><a class="nav-link" href="#build-data"><span class="header-section-number">3.8</span> Build Data</a></li>
<li><a class="nav-link" href="#date-time"><span class="header-section-number">3.9</span> Date-Time</a></li>
<li><a class="nav-link" href="#implement-vod"><span class="header-section-number">3.10</span> Implement VOD</a></li>
<li><a class="nav-link" href="#bar-graphs"><span class="header-section-number">3.11</span> Bar Graphs</a></li>
<li><a class="nav-link" href="#collapse"><span class="header-section-number">3.12</span> Collapse</a></li>
<li><a class="nav-link" href="#visualizing-veil-of-darkness"><span class="header-section-number">3.13</span> Visualizing Veil of Darkness</a></li>
<li><a class="nav-link" href="#improving-aesthetics"><span class="header-section-number">3.14</span> Improving Aesthetics</a></li>
<li><a class="nav-link" href="#conclusion-1"><span class="header-section-number">3.15</span> Conclusion</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/03-week3.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/03-week3.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Econ5/Poli5D</strong>" was written by David Arnold. It was last built on 2022-08-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
