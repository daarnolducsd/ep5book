<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 The Rug Rat Race | Econ5/Poli5D</title>
<meta name="author" content="David Arnold">
<meta name="description" content="7.1 Time Diaries   code {  background-color: #f1f1f1; } Figure 7.1 plots a somewhat puzzling finding from Ramey and Ramey (2010). The figure shows the amount of hours per week mothers spend on...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 7 The Rug Rat Race | Econ5/Poli5D">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/geisel.jpg">
<meta property="og:description" content="7.1 Time Diaries   code {  background-color: #f1f1f1; } Figure 7.1 plots a somewhat puzzling finding from Ramey and Ramey (2010). The figure shows the amount of hours per week mothers spend on...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 The Rug Rat Race | Econ5/Poli5D">
<meta name="twitter:description" content="7.1 Time Diaries   code {  background-color: #f1f1f1; } Figure 7.1 plots a somewhat puzzling finding from Ramey and Ramey (2010). The figure shows the amount of hours per week mothers spend on...">
<meta name="twitter:image" content="/images/geisel.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/webex.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Econ5/Poli5D</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li class="book-part">Excel</li>
<li><a class="" href="college-instruction-experiments.html"><span class="header-section-number">1</span> College Instruction Experiments</a></li>
<li class="book-part">Stata</li>
<li><a class="" href="intergenerational-mobility.html"><span class="header-section-number">2</span> Intergenerational Mobility</a></li>
<li><a class="" href="discrimination-in-police-stops.html"><span class="header-section-number">3</span> Discrimination in Police Stops</a></li>
<li><a class="" href="classroom-technology.html"><span class="header-section-number">4</span> Classroom Technology</a></li>
<li><a class="" href="legacy-of-colonial-medicine.html"><span class="header-section-number">5</span> Legacy of Colonial Medicine</a></li>
<li class="book-part">R</li>
<li><a class="" href="resume-experiments.html"><span class="header-section-number">6</span> Resume Experiments</a></li>
<li><a class="active" href="the-rug-rat-race.html"><span class="header-section-number">7</span> The Rug Rat Race</a></li>
<li><a class="" href="automated-pollution-monitoring.html"><span class="header-section-number">8</span> Automated Pollution Monitoring</a></li>
<li><a class="" href="voting.html"><span class="header-section-number">9</span> Voting</a></li>
<li><a class="" href="unconditional-cash-transfers.html"><span class="header-section-number">10</span> Unconditional Cash Transfers</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="the-rug-rat-race" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> The Rug Rat Race<a class="anchor" aria-label="anchor" href="#the-rug-rat-race"><i class="fas fa-link"></i></a>
</h1>
<div id="time-diaries" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Time Diaries<a class="anchor" aria-label="anchor" href="#time-diaries"><i class="fas fa-link"></i></a>
</h2>


<style>
code {
  background-color: #f1f1f1;
}
</style>
<p>Figure <a href="the-rug-rat-race.html#fig:rugrat">7.1</a> plots a somewhat puzzling finding from Ramey and Ramey (2010). The figure shows the amount of hours per week mothers spend on childcare over time. For both college-educated and less-than-college-educated mothers, time spent on childcare rose dramatically in the early 1990s?</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rugrat"></span>
<img src="images/07_RugRatMothers.png" alt="Time Spent on Childcare by Parents, by Educational Attainment, 1965-2008" width="90%"><p class="caption">
Figure 7.1: Time Spent on Childcare by Parents, by Educational Attainment, 1965-2008
</p>
</div>
<p>This rise occurs for both college-educated and less-educated mothers, but the rise is especially dramatic for college-educated mothers. Why is this puzzling? Well, this is a time period in which the returns to education were increasing a lot. In other words, these college-educated mothers had a lot to gain from working in the labor market, but in the data, we find they are spending more time on childcare. In this section of the course, we will explore why.</p>
<p>In order to explore this question we will use data from the American Time Use Survey (ATUS). This is a survey administered by the Bureau of Labor Statistics, and agency that collects many important statistics concerning the U.S. economy.</p>
<p>The data is based on "time diaries" which are detailed descriptions of the activities in a given day. For example, if the interview was held on a Tuesday, the individual would report everything they did on Monday (from 4 AM Monday to 4 AM Tuesday). This is a useful survey technique to get an accurate representation of how much time people spend on various activities.</p>
<p>Before digging into the data, however, we are going to learn a bit more about the R programming language. In particular, in this chapter we will cover some important functions for <strong>data wrangling</strong>.</p>
</div>
<div id="conditional-statements" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Conditional Statements<a class="anchor" aria-label="anchor" href="#conditional-statements"><i class="fas fa-link"></i></a>
</h2>
<p>The basic idea behind conditional statements is that sometimes in R we want to execute some code, but only if a certain condition is true. Conditional statements are incredibly important in all programming languages. For example, when you type something on a computer and get and error statement, that is a conditional statement at work. A certain condition was met (some error in this case), so the computer output an error message.</p>
<p>The way we will implement this idea in R is to use <code>if</code> statements. The general syntax for <code>if</code> statements is:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="the-rug-rat-race.html#cb284-1" tabindex="-1"></a><span class="cf">if</span> (logical statement) {</span>
<span id="cb284-2"><a href="the-rug-rat-race.html#cb284-2" tabindex="-1"></a>  </span>
<span id="cb284-3"><a href="the-rug-rat-race.html#cb284-3" tabindex="-1"></a>  code to be executed <span class="cf">if</span> logical statement is <span class="cn">TRUE</span></span>
<span id="cb284-4"><a href="the-rug-rat-race.html#cb284-4" tabindex="-1"></a>  </span>
<span id="cb284-5"><a href="the-rug-rat-race.html#cb284-5" tabindex="-1"></a>}</span></code></pre></div>
<p>It might be a bit easier to understand this syntax with a simple example. To begin, we are going to create an object in R called <code>door</code> which is equal to <code>locked</code>.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">door</span> <span class="op">&lt;-</span> <span class="st">"locked"</span></span></code></pre></div>
<p>Now, we are going to write some code to return a message if the object <code>door</code> is indeed locked.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="the-rug-rat-race.html#cb286-1" tabindex="-1"></a><span class="cf">if</span> (door<span class="sc">==</span><span class="st">"locked"</span>) {</span>
<span id="cb286-2"><a href="the-rug-rat-race.html#cb286-2" tabindex="-1"></a>  </span>
<span id="cb286-3"><a href="the-rug-rat-race.html#cb286-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"sorry, you need a key to enter"</span>)</span>
<span id="cb286-4"><a href="the-rug-rat-race.html#cb286-4" tabindex="-1"></a>  </span>
<span id="cb286-5"><a href="the-rug-rat-race.html#cb286-5" tabindex="-1"></a>}</span>
<span id="cb286-6"><a href="the-rug-rat-race.html#cb286-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"sorry, you need a key to enter"</span></span></code></pre></div>
<p>What is R doing here? Well, because we have assigned the value <code>locked</code> to the object door, the logical statement in parentheses <code>door=="locked"</code> is TRUE. Therefore, if we run this section of code, the code inside the curly brackets <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code> will be executed. In this case, the code just prints a message.</p>
<p>What happens if we change the value of door to <code>unlocked</code>. Well, in that case <code>door=="locked"</code> is no longer TRUE. Therefore, the code inside the brackets will <strong>not</strong> be executed.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">door</span> <span class="op">&lt;-</span> <span class="st">"unlocked"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">door</span><span class="op">==</span><span class="st">"locked"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"sorry, you need a key to enter"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let's try another example. Say we take a random draw from three numbers: -1, 0, and 1. We can take a random draw from this list of numbers by using the sample function:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="the-rug-rat-race.html#cb288-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb288-2"><a href="the-rug-rat-race.html#cb288-2" tabindex="-1"></a>x</span>
<span id="cb288-3"><a href="the-rug-rat-race.html#cb288-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<p>The part of the code <code>-1:1</code> controls what numbers will be drawn. If you type <code>-1:1</code> in R, you will see it prints out the numbers -1,0, and 1. The second part of the code <code>,1</code> tells R how many random samples to take. In this case, just 1. So overall, this code is simply setting x equal to either -1, 0, or 1 and doing so randomly.</p>
<p>So now let's write a conditional statement that depends on the outcome of x. Let's write some code that returns the absolute value of x, but only if x is less than zero.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, let's discuss <code>else</code> statements. Sometimes, we want to execute certain code if the statement is TRUE, but some other code if it is FALSE. For example, in our first example, imagine if the <code>door</code> object is not equal to <code>locked</code> then we want R to print out the message <code>Please Come in!</code>. The way we can do this in R is with an <code>else</code> statement:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="the-rug-rat-race.html#cb290-1" tabindex="-1"></a>door <span class="ot">&lt;-</span> <span class="st">"locked"</span></span>
<span id="cb290-2"><a href="the-rug-rat-race.html#cb290-2" tabindex="-1"></a><span class="cf">if</span> (door<span class="sc">==</span><span class="st">"locked"</span>){</span>
<span id="cb290-3"><a href="the-rug-rat-race.html#cb290-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Sorry, you need a key to enter"</span>)</span>
<span id="cb290-4"><a href="the-rug-rat-race.html#cb290-4" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb290-5"><a href="the-rug-rat-race.html#cb290-5" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Please Come in!"</span>)</span>
<span id="cb290-6"><a href="the-rug-rat-race.html#cb290-6" tabindex="-1"></a>}</span>
<span id="cb290-7"><a href="the-rug-rat-race.html#cb290-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Sorry, you need a key to enter"</span></span></code></pre></div>
<p>Since we set <code>door&lt;-"locked"</code>, the first statement <code>door=="locked"</code> is TRUE. Therefore, the code inside the first curly brackets was executed. Now, let's change door to unlocked and see how this changes the output.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="the-rug-rat-race.html#cb291-1" tabindex="-1"></a>door <span class="ot">&lt;-</span> <span class="st">"unlocked"</span></span>
<span id="cb291-2"><a href="the-rug-rat-race.html#cb291-2" tabindex="-1"></a><span class="cf">if</span> (door<span class="sc">==</span><span class="st">"locked"</span>){</span>
<span id="cb291-3"><a href="the-rug-rat-race.html#cb291-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Sorry, you need a key to enter"</span>)</span>
<span id="cb291-4"><a href="the-rug-rat-race.html#cb291-4" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb291-5"><a href="the-rug-rat-race.html#cb291-5" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Please Come in!"</span>)</span>
<span id="cb291-6"><a href="the-rug-rat-race.html#cb291-6" tabindex="-1"></a>}</span>
<span id="cb291-7"><a href="the-rug-rat-race.html#cb291-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Please Come in!"</span></span></code></pre></div>
<p>So now the first statement <code>door=="locked"</code> is FALSE. Therefore, R executes the code after the <code>else {}</code>.</p>
<p>There are a few important notes about conditional statements before we move on. First, the <code>else</code> must appear on the same line as the end curly bracket <code>}</code>. If it doesn't, then R doesn't know what logical statement to connect the <code>else</code> to. Second, R will execute the code after the <code>else</code> brackets if <code>door=="locked"</code> is FALSE for any reason.</p>
<p>For example, imagine I set <code>door &lt;- "Locked"</code>. While it might look like the first logical statement <code>door=="locked"</code> is true, R is case sensitive. Therefore, in this case, the statement <code>door=="locked"</code> is FALSE. This implies that R will print out the words <code>Please Come in!</code>.</p>
</div>
<div id="for-loops" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> For Loops<a class="anchor" aria-label="anchor" href="#for-loops"><i class="fas fa-link"></i></a>
</h2>
<p>In data analysis, we often find ourselves performing the same operation many times. We might be performing the same analysis for different variables or performing the same calculation for many different numbers.</p>
<p>One way to perform this analysis is through writing scripts with many, many lines of code. Much of the code might be exactly the same, but simply changes a single number or variable. An alternative way to perform this computation is through <strong>loops</strong>. Although we are learning how to implement loops in R, loops are a concept that you should be aware of in any programming language.</p>
<p>The general form for a loop in R is given below:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="the-rug-rat-race.html#cb292-1" tabindex="-1"></a><span class="cf">for</span> (some set of things) {</span>
<span id="cb292-2"><a href="the-rug-rat-race.html#cb292-2" tabindex="-1"></a>  do some stuff</span>
<span id="cb292-3"><a href="the-rug-rat-race.html#cb292-3" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>for</code> tells R this will be a for loop. Some set of things will depend on exactly what you are trying to do. Often, it will be a list of numbers. The next part of the code <code>{</code> tells R that everything that follows is part of the loop. The end curly bracket <code>}</code> tells R that the loop is over.</p>
<p>To understand these concepts more concretely. We are going to go through a simple example. Let's imagine that someone has demanded you use R to print out <code>2*i</code> for <code>i</code> equal to 1, 2, 3, 4, and 5. In simpler language, multiply each number between 1 and 5 by 2 and then print out the result. We are going to perform this in what we will call the brute force method.</p>
<p>First, let's print out <code>2*1</code></p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="the-rug-rat-race.html#cb293-1" tabindex="-1"></a>i <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb293-2"><a href="the-rug-rat-race.html#cb293-2" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb293-3"><a href="the-rug-rat-race.html#cb293-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span></code></pre></div>
<p>So why did we code this in such a roundabout way? Why not directly type <code>2*1</code>. Well, once we go through the loop it will become clear why we are coding this in a somewhat roundabout way. What you need to understand now is exactly what the code is doing. First, it is creating an object named <code>i</code> that is equal to <code>1</code>. Then, it is multiplying that object by 2 and printing out the result. Now, we have to do this for the number 2.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="the-rug-rat-race.html#cb294-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb294-2"><a href="the-rug-rat-race.html#cb294-2" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb294-3"><a href="the-rug-rat-race.html#cb294-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
<p>Note that the second part of the code <code>print(2*i)</code> is exactly the same as before. That will be key when we are writing our loop. We can continue to do this for the rest of the numbers</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="the-rug-rat-race.html#cb295-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb295-2"><a href="the-rug-rat-race.html#cb295-2" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb295-3"><a href="the-rug-rat-race.html#cb295-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">6</span></span></code></pre></div>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="the-rug-rat-race.html#cb296-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb296-2"><a href="the-rug-rat-race.html#cb296-2" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb296-3"><a href="the-rug-rat-race.html#cb296-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">8</span></span></code></pre></div>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="the-rug-rat-race.html#cb297-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">5</span> </span>
<span id="cb297-2"><a href="the-rug-rat-race.html#cb297-2" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb297-3"><a href="the-rug-rat-race.html#cb297-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">10</span></span></code></pre></div>
<p>In each block of code, the only thing changing is what <code>i</code> is equal to. Well, this is exactly what a loop does.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="the-rug-rat-race.html#cb298-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb298-2"><a href="the-rug-rat-race.html#cb298-2" tabindex="-1"></a>  </span>
<span id="cb298-3"><a href="the-rug-rat-race.html#cb298-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb298-4"><a href="the-rug-rat-race.html#cb298-4" tabindex="-1"></a></span>
<span id="cb298-5"><a href="the-rug-rat-race.html#cb298-5" tabindex="-1"></a>}</span>
<span id="cb298-6"><a href="the-rug-rat-race.html#cb298-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb298-7"><a href="the-rug-rat-race.html#cb298-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb298-8"><a href="the-rug-rat-race.html#cb298-8" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">6</span></span>
<span id="cb298-9"><a href="the-rug-rat-race.html#cb298-9" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">8</span></span>
<span id="cb298-10"><a href="the-rug-rat-race.html#cb298-10" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">10</span></span></code></pre></div>
<p>When we type <code>for (i in 1:5)</code> we are telling R to execute <code>print(2*i)</code> 5 times. The first time, <code>i==1</code>. This is referred to as the first <strong>iteration</strong> of the loop. Once it has executed the code for <code>i==1</code>, it should move on to <code>i==2</code>. This is the second iteration of the loop.</p>
<p>The great thing about this is that it can greatly increase the efficiency of our coding. For example, imagine we wanted to print out <code>2*i</code> for <code>i=1:100</code>. If we go the brute force way, that would be 200 lines of code (first setting <code>i</code> equal to the given number and then executing the code). But with the loop, only one thing changes: in the first line we simply type <code>for (i in 1:100)</code>.</p>
<p>In this example we are <strong>iterating</strong> over a list of numbers from 1 to 5. You can also iterate over other objects in R. For example, instead of iterating over a sequence of numbers, you can iterate over a vector.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="the-rug-rat-race.html#cb299-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">99</span>)){</span>
<span id="cb299-2"><a href="the-rug-rat-race.html#cb299-2" tabindex="-1"></a>  <span class="fu">print</span>(<span class="dv">2</span><span class="sc">*</span>i)</span>
<span id="cb299-3"><a href="the-rug-rat-race.html#cb299-3" tabindex="-1"></a>}</span>
<span id="cb299-4"><a href="the-rug-rat-race.html#cb299-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">6</span></span>
<span id="cb299-5"><a href="the-rug-rat-race.html#cb299-5" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">20</span></span>
<span id="cb299-6"><a href="the-rug-rat-race.html#cb299-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">198</span></span></code></pre></div>
<p>In this loop, in the first iteration, <code>i</code> is equal to 3. In the second iteration <code>i</code> is equal to 10. In the third <code>i</code> is equal to 99.</p>
<p>Next, we are going to go through an example that loops over words instead of numbers. In this example, we are going to print out a to do list. Let's say we need to do three sets of homework assignments: math, reading, and writing. To start this example, let's create a vector of the assignments we need to do:</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">homework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"math"</span>, <span class="st">"reading"</span>, <span class="st">"writing"</span><span class="op">)</span></span></code></pre></div>
<p>We can loop over the contents of this vector in order to print out a to-do list.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="the-rug-rat-race.html#cb301-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> homework) {</span>
<span id="cb301-2"><a href="the-rug-rat-race.html#cb301-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Do"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb301-3"><a href="the-rug-rat-race.html#cb301-3" tabindex="-1"></a>}</span>
<span id="cb301-4"><a href="the-rug-rat-race.html#cb301-4" tabindex="-1"></a>Do math </span>
<span id="cb301-5"><a href="the-rug-rat-race.html#cb301-5" tabindex="-1"></a>Do reading </span>
<span id="cb301-6"><a href="the-rug-rat-race.html#cb301-6" tabindex="-1"></a>Do writing </span></code></pre></div>
<p>We introduced a few new things here, so let's go through the code slowly. First, instead of looping over numbers here, we are looping over words. In the first iteration <code>i</code> is equal to the first entry of the vector <code>homework</code>. Therefore, <code>i</code> is equal to <code>math</code> in the first iteration.</p>
<p>Next, we have used a knew function <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>. This function concatenates and prints. Therefore, if we type <code>cat("Do",i)</code> what you should interpret (in the first) iteration is that we are forming the sentence <code>Do Math</code>. The last part <code>,"\n"</code> is telling R to display the next text a line down.. When you want to skip a line in a word document, you just press Enter. In R, you can type <code>"\n"</code>. If you are still unsure what <code>"\n"</code> is doing, you should try to take it out of the code and see how the result looks.</p>
<p>In this example, we are looping over the words in <code>homework</code>. An alternative way to write this loop out will take advantage of indexing. The following code performs the exact same process as above, it is just coded in a slightly different way.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="the-rug-rat-race.html#cb302-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(homework)) {</span>
<span id="cb302-2"><a href="the-rug-rat-race.html#cb302-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Do"</span>, homework[i], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb302-3"><a href="the-rug-rat-race.html#cb302-3" tabindex="-1"></a>}</span>
<span id="cb302-4"><a href="the-rug-rat-race.html#cb302-4" tabindex="-1"></a>Do math </span>
<span id="cb302-5"><a href="the-rug-rat-race.html#cb302-5" tabindex="-1"></a>Do reading </span>
<span id="cb302-6"><a href="the-rug-rat-race.html#cb302-6" tabindex="-1"></a>Do writing </span></code></pre></div>
<p>In this loop, we are again looping over numbers. <code>length(homework)</code> is equal to 3. So we are looping over the numbers 1 to 3. In the first iteration, we are concatenating the words "Do" and <code>homework[1]</code>. Since <code>homework[1]</code> is equal to Math, we are retrieving the exact same output as before.</p>
<p>So why would we want to code this loop in this way? Well, in this setting, it doesn't really matter how you write the code. However, that won't always be the case. Using the loop index (<code>i</code>) in order to subset vectors or data frames is a very common practice, so it is important to be exposed to this aspect of loops as well.</p>
</div>
<div id="for-loops-data" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> For Loops (Data)<a class="anchor" aria-label="anchor" href="#for-loops-data"><i class="fas fa-link"></i></a>
</h2>
<p>Next, we are going to use for loops to make calculations in our data. To remind you, our empirical application is going to study how time spent on childcare, particularly for mothers, has changed over time. To begin, we are going to load in data from the American Time Use Survey.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="the-rug-rat-race.html#cb303-1" tabindex="-1"></a>rr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"rugratrace.csv"</span>)</span>
<span id="cb303-2"><a href="the-rug-rat-race.html#cb303-2" tabindex="-1"></a><span class="fu">dim</span>(rr)</span>
<span id="cb303-3"><a href="the-rug-rat-race.html#cb303-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">106020</span>     <span class="dv">54</span></span></code></pre></div>
<p>As you can see, this is a pretty large dataset. There are 106,020 observations and 54 variables. Because this data is so large, we are first going to explain a subset of variables that we will be focusing on. Our goal is to compute time spent on childcare over time for mothers. The variable <code>mother2</code> is an indicator variable that is equal to one if the individual is a mother with a child currently living in the household. <code>age</code> is holds the age of the individual. <code>childtot</code> is the total hours spent on childcare in a week. <code>dataset</code> actually holds the year the data was collected. Different years come from datasets. This will be important to keep in mind going forward with the analysis.</p>
<p>Our goal is to follow the Ramey and Ramey (2010) analysis as closely as possible. In order to do this, we are going to make a number of restrictions in our data so that we have the same sample of individuals studied by Ramey and Ramey (2010). This will involve restricting to mothers between ages 25 and 34 with a child in the household. In terms of the variables in the data frame, these are individuals such that <code>age&gt;=25 &amp; age&lt;=34 &amp; mother2==1</code>. This is a logical statement composed of three statements, strung together by <code>&amp;</code> operators. Therefore, in order to be <code>TRUE</code>, every individual statement must be <code>TRUE</code>. You should be able to convince yourself that this statement is only <code>TRUE</code> for mothers between the ages of 25-34.</p>
<p>The way we can subset to these individuals is through the <code>subset</code> command.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">rr</span>, <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a data frame restricted to the sample we are analyzing. Our goal is to compute the average amount of <code>childtot</code> over years (in our case, over different values of the variable <code>dataset</code>). Therefore, what we need next is a list of the years in the data frame.</p>
<p>Luckily, there is a function <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> that will come in handy here. <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> retrieves list of the unique values of a variable. In other words, if we type <code>unique(rr$dataset)</code> we will get a list of all the years in the data frame.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="the-rug-rat-race.html#cb305-1" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(mothers2534<span class="sc">$</span>dataset)</span>
<span id="cb305-2"><a href="the-rug-rat-race.html#cb305-2" tabindex="-1"></a>years</span>
<span id="cb305-3"><a href="the-rug-rat-race.html#cb305-3" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">1965</span> <span class="dv">1975</span> <span class="dv">1985</span> <span class="dv">1993</span> <span class="dv">1998</span> <span class="dv">2003</span> <span class="dv">2004</span> <span class="dv">2005</span> <span class="dv">2006</span> <span class="dv">2007</span> <span class="dv">2008</span></span></code></pre></div>
<p>So we are going to write a loop and iterate over the years. Before writing the full loop, let's make sure we understand how to code this for the first iteration. First, let's set <code>i</code> equal to one.</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span></code></pre></div>
<p>Next, let's subset the data so that we create a dataframe that only contains observations such that <code>dataset==years[i]</code>. Since <code>i</code> is currently equal to 1, this will subset the data to observations from 1965.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mothers2534</span>, <span class="va">dataset</span><span class="op">==</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Since the data frame <code>sub</code> only contains observations from 1965, we can simply take the average of <code>childtot</code> within this data frame to retrieve the average amount of hours spent on childcare per week in 1965.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="the-rug-rat-race.html#cb308-1" tabindex="-1"></a><span class="fu">mean</span>(sub<span class="sc">$</span>childtot)</span>
<span id="cb308-2"><a href="the-rug-rat-race.html#cb308-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">13.82249</span></span></code></pre></div>
<p>When we actually go to iterating over a loop, we will want to keep track of what each number printed out corresponds to. Therefore, let's use the <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> function to clarify exactly what is being printed out. We are actually going to print out two things. First, we are going to print out the year we are studying. Then, we are going to print out the average childcare in that year.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="the-rug-rat-race.html#cb309-1" tabindex="-1"></a><span class="co"># prints out year</span></span>
<span id="cb309-2"><a href="the-rug-rat-race.html#cb309-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Year"</span>, years[i],<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-3"><a href="the-rug-rat-race.html#cb309-3" tabindex="-1"></a>Year <span class="dv">1965</span> </span>
<span id="cb309-4"><a href="the-rug-rat-race.html#cb309-4" tabindex="-1"></a><span class="co"># prints out average childcare for this group</span></span>
<span id="cb309-5"><a href="the-rug-rat-race.html#cb309-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average childcare per week:"</span>, <span class="fu">mean</span>(sub<span class="sc">$</span>childtot),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-6"><a href="the-rug-rat-race.html#cb309-6" tabindex="-1"></a>Average childcare per week<span class="sc">:</span> <span class="fl">13.82249</span> </span></code></pre></div>
<p>Now that we have written all the code for <code>i&lt;-1</code>, we just need to put this code inside a loop that loops over from 1 to the total number of years. The total number of years is given by <code>length(years)</code>:</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># subset to year i</span></span>
<span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mothers2534</span>, <span class="va">dataset</span><span class="op">==</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># prints out year</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># prints out average childcare for this group</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Average childcare per week:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sub</span><span class="op">$</span><span class="va">childtot</span><span class="op">)</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>Year 1965 
Average childcare per week: 13.82249 
Year 1975 
Average childcare per week: 9.758393 
Year 1985 
Average childcare per week: 12.86947 
Year 1993 
Average childcare per week: 9.244037 
Year 1998 
Average childcare per week: 14.83095 
Year 2003 
Average childcare per week: 16.02707 
Year 2004 
Average childcare per week: 16.45709 
Year 2005 
Average childcare per week: 15.68486 
Year 2006 
Average childcare per week: 16.23848 
Year 2007 
Average childcare per week: 17.01327 
Year 2008 
Average childcare per week: 16.24845 </code></pre>
<p>As we can see in this table, this replicates one of the main findings in Ramey and Ramey (2010). In 1965-1993, the average time spent on childcare fluctuated between 9 and 13 hours. From 1998 onwards, the average amount of time spent on childcare increases dramatically, often between 15-17 hours per week on average.</p>
</div>
<div id="tidyverse" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h2>
<p>So far we have been using what is referred to as base R. We have only utilized functions that come standard in R. However, one of the main strengths of R is its very active user community. Because R is open-source, users can write their own packages in R and make them widely available. This means the functionality of R is essentially growing every day.</p>
<p>One of the most useful collection of packages for data analysis is the tidyverse package. This collection of packages can do many things. We will cover a small portion of what the package is capable of. If you want to get a more thorough understanding of the tidyverse, you can go to <a href="https://r4ds.had.co.nz/">R for Data Science</a> and read more.</p>
<p>But before using the tidyverse, we actually have to install it into our version of R. In order to install a package, you can use the <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> function. For example, to install tidyverse, type:</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre></div>
<p>This will download all the necessary components of the tidyverse package onto your computer. You only need to install a package once.</p>
<p>Next, in order to use a package in a given R session, you need to load it into memory using the <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> function:</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>A common mistake for students is to forget to load a package for a given R session. If you do this, you might get an error such as "[function] not found". If you are using functions from an external package, you need to make sure to load that package in every session of R that you want to use it in.</p>
<p>The first concept we will learn from tidyverse is the concept of a tibble. A tibble is very similar to what we have been calling a data frame. For our purposes, you can think of a tibble as synonymous with data frame. The main difference is in how the data is stored and presented. For us, this won't matter too much. For larger datasets, sometimes loading as a tibble can make a big difference in terms of how long computations take.</p>
<p>To start, let's load <code>rugratrace.csv</code> as a data frame.</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"rugratrace.csv"</span><span class="op">)</span></span></code></pre></div>
<p>To convert a data frame to a tibble, you can use the function <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code>.</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span></code></pre></div>
<p>If you are following along, you may think the code above did not actually do anything. However, you can tell the difference if you print out the data set.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="the-rug-rat-race.html#cb316-1" tabindex="-1"></a>rr</span>
<span id="cb316-2"><a href="the-rug-rat-race.html#cb316-2" tabindex="-1"></a><span class="co"># A tibble: 106,020 Ã— 54</span></span>
<span id="cb316-3"><a href="the-rug-rat-race.html#cb316-3" tabindex="-1"></a>   state   age   sex ethnic under18 under5 ageyngst student</span>
<span id="cb316-4"><a href="the-rug-rat-race.html#cb316-4" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>    <span class="er">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb316-5"><a href="the-rug-rat-race.html#cb316-5" tabindex="-1"></a> <span class="dv">1</span>    <span class="dv">23</span>    <span class="dv">26</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">4</span>      <span class="dv">2</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-6"><a href="the-rug-rat-race.html#cb316-6" tabindex="-1"></a> <span class="dv">2</span>    <span class="dv">23</span>    <span class="dv">53</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">1</span>      <span class="dv">0</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-7"><a href="the-rug-rat-race.html#cb316-7" tabindex="-1"></a> <span class="dv">3</span>    <span class="dv">23</span>    <span class="dv">21</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">2</span>      <span class="dv">2</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-8"><a href="the-rug-rat-race.html#cb316-8" tabindex="-1"></a> <span class="dv">4</span>    <span class="dv">23</span>    <span class="dv">24</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">2</span>      <span class="dv">2</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-9"><a href="the-rug-rat-race.html#cb316-9" tabindex="-1"></a> <span class="dv">5</span>    <span class="dv">23</span>    <span class="dv">25</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">3</span>      <span class="dv">1</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-10"><a href="the-rug-rat-race.html#cb316-10" tabindex="-1"></a> <span class="dv">6</span>    <span class="dv">23</span>    <span class="dv">33</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">4</span>      <span class="dv">2</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-11"><a href="the-rug-rat-race.html#cb316-11" tabindex="-1"></a> <span class="dv">7</span>    <span class="dv">23</span>    <span class="dv">26</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">3</span>      <span class="dv">2</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-12"><a href="the-rug-rat-race.html#cb316-12" tabindex="-1"></a> <span class="dv">8</span>    <span class="dv">23</span>    <span class="dv">61</span>     <span class="dv">1</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">0</span>      <span class="dv">0</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-13"><a href="the-rug-rat-race.html#cb316-13" tabindex="-1"></a> <span class="dv">9</span>    <span class="dv">23</span>    <span class="dv">57</span>     <span class="dv">1</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">0</span>      <span class="dv">0</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-14"><a href="the-rug-rat-race.html#cb316-14" tabindex="-1"></a><span class="dv">10</span>    <span class="dv">23</span>    <span class="dv">43</span>     <span class="dv">2</span>     <span class="sc">-</span><span class="dv">9</span>       <span class="dv">2</span>      <span class="dv">1</span>       <span class="cn">NA</span>       <span class="dv">0</span></span>
<span id="cb316-15"><a href="the-rug-rat-race.html#cb316-15" tabindex="-1"></a><span class="co"># â„¹ 106,010 more rows</span></span>
<span id="cb316-16"><a href="the-rug-rat-race.html#cb316-16" tabindex="-1"></a><span class="co"># â„¹ 46 more variables: act20 &lt;int&gt;, act21 &lt;int&gt;,</span></span>
<span id="cb316-17"><a href="the-rug-rat-race.html#cb316-17" tabindex="-1"></a><span class="co">#   act26 &lt;int&gt;, act24 &lt;int&gt;, act22 &lt;int&gt;, act23 &lt;int&gt;,</span></span>
<span id="cb316-18"><a href="the-rug-rat-race.html#cb316-18" tabindex="-1"></a><span class="co">#   act27 &lt;int&gt;, act67 &lt;int&gt;, act25 &lt;int&gt;, act29 &lt;int&gt;,</span></span>
<span id="cb316-19"><a href="the-rug-rat-race.html#cb316-19" tabindex="-1"></a><span class="co">#   recwght &lt;dbl&gt;, dataset &lt;int&gt;, fips &lt;int&gt;,</span></span>
<span id="cb316-20"><a href="the-rug-rat-race.html#cb316-20" tabindex="-1"></a><span class="co">#   married &lt;int&gt;, working &lt;int&gt;, fulltime &lt;int&gt;,</span></span>
<span id="cb316-21"><a href="the-rug-rat-race.html#cb316-21" tabindex="-1"></a><span class="co">#   parttime &lt;int&gt;, mother2 &lt;int&gt;, father2 &lt;int&gt;, â€¦</span></span></code></pre></div>
<p>You get more information printing out a tibble relative to a data frame. For our purposes, it won't matter too much if you load a dataset as a tibble or a data frame. However, it is important to understand these concepts, as you may see various online resources reference a tibble or a data frame. Generally, in this class we will load our datasets as tibbles from now on.</p>
<p>To load a dataset as a tibble directly, you can use the <code>read_csv</code> function, the only difference being now an underscore separates the words in the function, rather than a period.</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"rugratrace.csv"</span><span class="op">)</span></span></code></pre></div>
<p>So now let's discuss some functions that come with tidyverse. The first functions we will introduce are <code>filter</code>, <code>select</code>, and <code>arrange</code>.</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function retrieves observations (rows) in the data that meet a certain condition. For example, maybe you want to restrict the analysis to a certain demographic. You can use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to do this. In our example, we want to restrict to mothers between ages 25 and 34. We can use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to accomplish this. The general syntax for <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> is:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="the-rug-rat-race.html#cb318-1" tabindex="-1"></a><span class="fu">filter</span>(dataframe, some logical statement)</span></code></pre></div>
<p>In our example, we can create the subset of the dataset we want by typing:</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rr</span>, <span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>You can use other logical operators in combination with filter as well. For example, imagine for a subset of our analysis we only want years between 2003 and 2008. We can use the operator <code>%in%</code> to accomplish this.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="the-rug-rat-race.html#cb320-1" tabindex="-1"></a><span class="fu">filter</span>(mothers2534, dataset<span class="sc">%in%</span><span class="dv">2003</span><span class="sc">:</span><span class="dv">2008</span>)</span>
<span id="cb320-2"><a href="the-rug-rat-race.html#cb320-2" tabindex="-1"></a><span class="co"># A tibble: 6,416 Ã— 54</span></span>
<span id="cb320-3"><a href="the-rug-rat-race.html#cb320-3" tabindex="-1"></a>   state   age   sex ethnic under18 under5 ageyngst student</span>
<span id="cb320-4"><a href="the-rug-rat-race.html#cb320-4" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>    <span class="er">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb320-5"><a href="the-rug-rat-race.html#cb320-5" tabindex="-1"></a> <span class="dv">1</span>    <span class="cn">NA</span>    <span class="dv">32</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">1</span>     <span class="cn">NA</span>        <span class="dv">2</span>       <span class="dv">1</span></span>
<span id="cb320-6"><a href="the-rug-rat-race.html#cb320-6" tabindex="-1"></a> <span class="dv">2</span>    <span class="cn">NA</span>    <span class="dv">33</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">3</span>     <span class="cn">NA</span>        <span class="dv">3</span>       <span class="dv">0</span></span>
<span id="cb320-7"><a href="the-rug-rat-race.html#cb320-7" tabindex="-1"></a> <span class="dv">3</span>    <span class="cn">NA</span>    <span class="dv">33</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">1</span>     <span class="cn">NA</span>        <span class="dv">7</span>       <span class="dv">0</span></span>
<span id="cb320-8"><a href="the-rug-rat-race.html#cb320-8" tabindex="-1"></a> <span class="dv">4</span>    <span class="cn">NA</span>    <span class="dv">32</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">1</span>     <span class="cn">NA</span>        <span class="dv">2</span>       <span class="dv">0</span></span>
<span id="cb320-9"><a href="the-rug-rat-race.html#cb320-9" tabindex="-1"></a> <span class="dv">5</span>    <span class="cn">NA</span>    <span class="dv">25</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">1</span>     <span class="cn">NA</span>        <span class="dv">6</span>       <span class="dv">0</span></span>
<span id="cb320-10"><a href="the-rug-rat-race.html#cb320-10" tabindex="-1"></a> <span class="dv">6</span>    <span class="cn">NA</span>    <span class="dv">34</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">2</span>     <span class="cn">NA</span>        <span class="dv">2</span>       <span class="dv">0</span></span>
<span id="cb320-11"><a href="the-rug-rat-race.html#cb320-11" tabindex="-1"></a> <span class="dv">7</span>    <span class="cn">NA</span>    <span class="dv">31</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">1</span>     <span class="cn">NA</span>        <span class="dv">2</span>       <span class="dv">0</span></span>
<span id="cb320-12"><a href="the-rug-rat-race.html#cb320-12" tabindex="-1"></a> <span class="dv">8</span>    <span class="cn">NA</span>    <span class="dv">32</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">2</span>     <span class="cn">NA</span>        <span class="dv">6</span>       <span class="dv">0</span></span>
<span id="cb320-13"><a href="the-rug-rat-race.html#cb320-13" tabindex="-1"></a> <span class="dv">9</span>    <span class="cn">NA</span>    <span class="dv">32</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">12</span>       <span class="dv">0</span></span>
<span id="cb320-14"><a href="the-rug-rat-race.html#cb320-14" tabindex="-1"></a><span class="dv">10</span>    <span class="cn">NA</span>    <span class="dv">32</span>     <span class="dv">2</span>     <span class="cn">NA</span>       <span class="dv">2</span>     <span class="cn">NA</span>        <span class="dv">3</span>       <span class="dv">0</span></span>
<span id="cb320-15"><a href="the-rug-rat-race.html#cb320-15" tabindex="-1"></a><span class="co"># â„¹ 6,406 more rows</span></span>
<span id="cb320-16"><a href="the-rug-rat-race.html#cb320-16" tabindex="-1"></a><span class="co"># â„¹ 46 more variables: act20 &lt;int&gt;, act21 &lt;int&gt;,</span></span>
<span id="cb320-17"><a href="the-rug-rat-race.html#cb320-17" tabindex="-1"></a><span class="co">#   act26 &lt;int&gt;, act24 &lt;int&gt;, act22 &lt;int&gt;, act23 &lt;int&gt;,</span></span>
<span id="cb320-18"><a href="the-rug-rat-race.html#cb320-18" tabindex="-1"></a><span class="co">#   act27 &lt;int&gt;, act67 &lt;int&gt;, act25 &lt;int&gt;, act29 &lt;int&gt;,</span></span>
<span id="cb320-19"><a href="the-rug-rat-race.html#cb320-19" tabindex="-1"></a><span class="co">#   recwght &lt;dbl&gt;, dataset &lt;int&gt;, fips &lt;int&gt;,</span></span>
<span id="cb320-20"><a href="the-rug-rat-race.html#cb320-20" tabindex="-1"></a><span class="co">#   married &lt;int&gt;, working &lt;int&gt;, fulltime &lt;int&gt;,</span></span>
<span id="cb320-21"><a href="the-rug-rat-race.html#cb320-21" tabindex="-1"></a><span class="co">#   parttime &lt;int&gt;, mother2 &lt;int&gt;, father2 &lt;int&gt;, â€¦</span></span></code></pre></div>
<p>This code is saying restrict to <code>mothers2534</code> only for observations such that dataset is in the range of 2003 through 2008. One important note here is that in the code above we did not overwrite <code>mothers2534</code>. That is why we can see the tibble being printed out. If you want to save the result of the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> you need to assign the resulting tibble a name. Otherwise it will simply be printed to the console but not actually saved.</p>
<p>Next, let's discuss <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. This function chooses which variables you want to remain in your tibble. For example, in our current tibble we have many variables, but we really only need a subset of them for our analysis. So we can select the variables we really need:</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mothers2534</span>, <span class="va">dataset</span>, <span class="va">mother2</span>, <span class="va">age</span>, <span class="va">childtot</span><span class="op">)</span></span></code></pre></div>
<p>Now if we print out <code>mothers2534</code>, it has only four variables now.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="the-rug-rat-race.html#cb322-1" tabindex="-1"></a>mothers2534</span>
<span id="cb322-2"><a href="the-rug-rat-race.html#cb322-2" tabindex="-1"></a><span class="co"># A tibble: 8,115 Ã— 4</span></span>
<span id="cb322-3"><a href="the-rug-rat-race.html#cb322-3" tabindex="-1"></a>   dataset mother2   age childtot</span>
<span id="cb322-4"><a href="the-rug-rat-race.html#cb322-4" tabindex="-1"></a>     <span class="sc">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb322-5"><a href="the-rug-rat-race.html#cb322-5" tabindex="-1"></a> <span class="dv">1</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">26</span>     <span class="dv">7</span>   </span>
<span id="cb322-6"><a href="the-rug-rat-race.html#cb322-6" tabindex="-1"></a> <span class="dv">2</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">25</span>     <span class="fl">7.58</span></span>
<span id="cb322-7"><a href="the-rug-rat-race.html#cb322-7" tabindex="-1"></a> <span class="dv">3</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">33</span>    <span class="fl">27.2</span> </span>
<span id="cb322-8"><a href="the-rug-rat-race.html#cb322-8" tabindex="-1"></a> <span class="dv">4</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">26</span>     <span class="fl">4.20</span></span>
<span id="cb322-9"><a href="the-rug-rat-race.html#cb322-9" tabindex="-1"></a> <span class="dv">5</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">25</span>     <span class="fl">6.42</span></span>
<span id="cb322-10"><a href="the-rug-rat-race.html#cb322-10" tabindex="-1"></a> <span class="dv">6</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">26</span>    <span class="fl">14.8</span> </span>
<span id="cb322-11"><a href="the-rug-rat-race.html#cb322-11" tabindex="-1"></a> <span class="dv">7</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">30</span>    <span class="fl">19.2</span> </span>
<span id="cb322-12"><a href="the-rug-rat-race.html#cb322-12" tabindex="-1"></a> <span class="dv">8</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">33</span>     <span class="fl">8.75</span></span>
<span id="cb322-13"><a href="the-rug-rat-race.html#cb322-13" tabindex="-1"></a> <span class="dv">9</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">30</span>    <span class="fl">16.3</span> </span>
<span id="cb322-14"><a href="the-rug-rat-race.html#cb322-14" tabindex="-1"></a><span class="dv">10</span>    <span class="dv">1965</span>       <span class="dv">1</span>    <span class="dv">29</span>    <span class="fl">29.8</span> </span>
<span id="cb322-15"><a href="the-rug-rat-race.html#cb322-15" tabindex="-1"></a><span class="co"># â„¹ 8,105 more rows</span></span></code></pre></div>
<p>Finally, our last function for this section is <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>. The <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function will sort the data based on the values of a variable. For example, imagine I want the observations in <code>mothers2534</code> to be arranged from the youngest age to the oldest age. I could type:</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mothers2534</span>,<span class="va">age</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can verify that the youngest individuals are first:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="the-rug-rat-race.html#cb324-1" tabindex="-1"></a><span class="fu">head</span>(mothers2534<span class="sc">$</span>age)</span>
<span id="cb324-2"><a href="the-rug-rat-race.html#cb324-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">25</span> <span class="dv">25</span> <span class="dv">25</span> <span class="dv">25</span> <span class="dv">25</span> <span class="dv">25</span></span></code></pre></div>
<p>And the oldest are last.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="the-rug-rat-race.html#cb325-1" tabindex="-1"></a><span class="fu">tail</span>(mothers2534<span class="sc">$</span>age)</span>
<span id="cb325-2"><a href="the-rug-rat-race.html#cb325-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span></span></code></pre></div>
<p>If you instead want to sort from the oldest to youngest, you can use the function <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code>, which stands for descending. In other words, the dataset will be sorted from the highest value to the lowest value.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="the-rug-rat-race.html#cb326-1" tabindex="-1"></a>mothers2534 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(mothers2534,<span class="fu">desc</span>(age))</span>
<span id="cb326-2"><a href="the-rug-rat-race.html#cb326-2" tabindex="-1"></a><span class="fu">head</span>(mothers2534<span class="sc">$</span>age)</span>
<span id="cb326-3"><a href="the-rug-rat-race.html#cb326-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span> <span class="dv">34</span></span></code></pre></div>
<p>To finish off this chapter, let's summarize all of the new functions in tidyverse that we learned. First, <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> is used in order to read data sets into R as a tibble. Next, we learned three functions that are useful for manipulating data. First, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> selects observations of the tibble that meet a certain condition. In our case, mothers between the ages 25 and 34. Second, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> chooses which variables to keep in a tibble. In our case, we kept variables that indicated whether an individual is a mother, the year the data was collected, the age of the individual, and the amount of time spent on childcare of the individual. Lastly, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> is used to sort the data based on a value of a variable. In this chapter we showed how to use this to sort the data from youngest to oldest.</p>
</div>
<div id="the-pipe-operator" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> The Pipe Operator<a class="anchor" aria-label="anchor" href="#the-pipe-operator"><i class="fas fa-link"></i></a>
</h2>
<p>In this section we are going to be going over the pipe operator: <code>%&gt;%</code>. The pipe operator is a very useful tool to use when working with the tidyverse. For our purposes, we can use it to string along a number of commands. Eventually, we will see that this greatly improves the efficiency of our code. First, however, we simply need to learn mechanically what the pipe operator does (although why we are using it might not be immediately clear).</p>
<p>So far, in R, we have been applying functions to objects. For example, imagine we have a vector <code>x</code> and we want to take the mean. We would apply the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> function to <code>x</code> by typing <code>mean(x)</code>. The pipe operator gives us an alternative way to write this. We can type: <code>x %&gt;% mean()</code>. In general, when we have a function <code>f()</code>, we can either write <code>f(x)</code> or <code>x %&gt;% f()</code>.</p>
<p>So what is the benefit of the pipe operator? Well, often in data analysis, we will want to apply many functions. For example, we may want to restrict to certain observations, select certain variables, and so on. We can think of this as applying many functions to an objects in sequency. For example, if we first apply <code>f()</code>, then <code>g()</code> and then <code>h()</code> we can represent this as:</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">h</span><span class="op">(</span><span class="fu">g</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Using pipe operators, we can equivalently write this out as:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">f</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="va">g</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="va">h</span></span></code></pre></div>
<p>What are we doing here? We are taking in an object x, and then applying f, and then applying g, and then applying h. When you read a pipe operator, you can think to yourself <strong>and then</strong>. This will be a helpful tool to remember what a pipe operator is doing. It is stringing together a number of different functions in R.</p>
<p>So far, this has been a relatively abstract discussion of pipe operators. Let's load some real data so we can see how this works in practice.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="the-rug-rat-race.html#cb329-1" tabindex="-1"></a>rr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"rugratrace.csv"</span>)</span>
<span id="cb329-2"><a href="the-rug-rat-race.html#cb329-2" tabindex="-1"></a>Rows<span class="sc">:</span> <span class="dv">106020</span> Columns<span class="sc">:</span> <span class="dv">54</span></span>
<span id="cb329-3"><a href="the-rug-rat-race.html#cb329-3" tabindex="-1"></a>â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span id="cb329-4"><a href="the-rug-rat-race.html#cb329-4" tabindex="-1"></a>Delimiter<span class="sc">:</span> <span class="st">","</span></span>
<span id="cb329-5"><a href="the-rug-rat-race.html#cb329-5" tabindex="-1"></a><span class="fu">dbl</span> (<span class="dv">54</span>)<span class="sc">:</span> state, age, sex, ethnic, under18, under5, agey...</span>
<span id="cb329-6"><a href="the-rug-rat-race.html#cb329-6" tabindex="-1"></a></span>
<span id="cb329-7"><a href="the-rug-rat-race.html#cb329-7" tabindex="-1"></a>â„¹ Use <span class="st">`</span><span class="at">spec()</span><span class="st">`</span> to retrieve the full column specification <span class="cf">for</span> this data.</span>
<span id="cb329-8"><a href="the-rug-rat-race.html#cb329-8" tabindex="-1"></a>â„¹ Specify the column types or set <span class="st">`</span><span class="at">show_col_types = FALSE</span><span class="st">`</span> to quiet this message.</span></code></pre></div>
<p>In a previous chapter, we generated a new data set that (1) filters to mothers between 25 and 34. To understand pipe operators, let's first see how we can perform the same task using <code>%&gt;%</code>.</p>
<p>To remind you, the code to filter from the previous section is:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rr</span>, <span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Instead, when we use a pipe operator, we first supply the data frame <code>rr</code> and then call the function (with the relevant logical statement):</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="va">rr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>This is a useful way to think about the pipe operators when using it with data. First supply the tibble or data frame, <strong>and then</strong> apply all the functions you would like to the data.</p>
<p>So far, we can't really see the benefit of the pipe operator with this example. It looks as if we have just rewritten the code. The main benefit for the pipe operator for us, however, will be that we can string along multiple commands. For example, imagine we want to (1) filter the data as above, and then (2) select only the variables we need. Before, we did this in two steps:</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter to mothers 25-34</span></span>
<span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rr</span>, <span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># select certain variables</span></span>
<span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mothers2534</span>, <span class="va">dataset</span>, <span class="va">mother2</span>, <span class="va">age</span>, <span class="va">childtot</span><span class="op">)</span></span></code></pre></div>
<p>These steps are not very efficient. In the first step we create <code>mothers2534</code>. In the next step, we overwrite it with a new <code>mothers2534</code>. In total, we needed to type <code>mothers2534</code> three different times to get the final tibble. Now, let's see how pipe operators will clean up this code:</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="va">rr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">mother2</span>, <span class="va">age</span>, <span class="va">childtot</span><span class="op">)</span></span></code></pre></div>
<p>Now the code is a bit easier to digest. What are we doing? First we are specifying the tibble <code>rr</code>, and then we are filtering it, and then we are selecting the variables we want. Now in this example, there are only two steps. But now imagine we want to also sort the dataset from oldest to youngest. No problem, we can just add a pipe operator that calls the <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function to the previous code:</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="va">rr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span><span class="op">&lt;=</span><span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span><span class="op">&gt;=</span><span class="fl">25</span> <span class="op">&amp;</span> <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">mother2</span>, <span class="va">age</span>, <span class="va">childtot</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And our resulting code is still very clear an interpretable. Now imagine you had many, many more steps you needed to perform. You will soon be glad you have the pipe operator!</p>
</div>
<div id="mutate" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Mutate<a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h2>
<p>So far, we have documented that parents increased the amount of time spent on childcare in the 1990s and through the 2000s. Ramey and Ramey (2010) further document that this increase is even more dramatic for college-educated mothers.</p>
<p>Ramey and Ramey (2010) argue the increased time spent on childcare for college-educated mothers is being driven by the competitiveness of college. To provide evidence for this, they break down the components of childcare. Figure <a href="the-rug-rat-race.html#fig:timebreakdown">7.2</a> from Ramey and Ramey (2010) plots the amount of time spent on childcare for college-educated and less-than-college educated mothers by type of care.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:timebreakdown"></span>
<img src="images/07_ChildCareByType.png" alt="Time Spent on Childcare, by Age of Child and Type of Care 2003-2008 " width="90%"><p class="caption">
Figure 7.2: Time Spent on Childcare, by Age of Child and Type of Care 2003-2008
</p>
</div>
<p>Let's focus on the top-right panel: mothers with children above the age of 5. College-educated mothers (the darker gray bars) are spending more time on a few categories: education, organizing and attending activities, and chauffeuring. Ramey and Ramey (2010) argue that these may be driven by college competitiveness. To be competitive in college, students need to earn higher scores on tests and participate in more extracurricular activities.</p>
<p>In our data, we are going to create a variable named <code>childcollegeprep</code> that is the sum total of time spent on education and time spent on travelling with children. Right now, however, our data set does not have this variable. So in order to add this, we will need to learn how to create variables in R.</p>
<p>There are two ways to create new variables in R. The first uses base R. The general syntax is:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">newvarname</span> <span class="op">&lt;-</span> <span class="va">expression</span></span></code></pre></div>
<p>For example, let's add the variable <code>childcollegeprep</code> which will be the addition of <code>childeduc</code> and <code>childtravel</code>, which are two variables in our <code>rugratrace.csv</code> data set.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="the-rug-rat-race.html#cb336-1" tabindex="-1"></a>rr<span class="sc">$</span>childcollegeprep <span class="ot">&lt;-</span> rr<span class="sc">$</span>childeduc <span class="sc">+</span> rr<span class="sc">$</span>childtravel</span>
<span id="cb336-2"><a href="the-rug-rat-race.html#cb336-2" tabindex="-1"></a><span class="fu">summary</span>(rr<span class="sc">$</span>childcollegeprep)</span>
<span id="cb336-3"><a href="the-rug-rat-race.html#cb336-3" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max.    NA<span class="st">'s </span></span>
<span id="cb336-4"><a href="the-rug-rat-race.html#cb336-4" tabindex="-1"></a><span class="st">  0.000   0.000   0.000   1.201   0.000  98.933    1146 </span></span></code></pre></div>
<p>So the mean amount of time spent on <code>childcollegprep</code> is about 1.2 hours. Recall we haven't made any restrictions on <code>rr</code>, so this includes everyone in the data set, including those who don't have children. This explains why the value is so much lower than the values we have been studying for mothers with children in the house.</p>
<p>We can also generate new variables using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function (from tidyverse). The general syntax is:</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">dataframe</span>, newvarname <span class="op">=</span> <span class="va">expression</span><span class="op">)</span></span></code></pre></div>
<p>For example, if we want to add <code>childprep</code> using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> we can type:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">rr</span>, childcollegeprep<span class="op">=</span><span class="va">childtravel</span><span class="op">+</span><span class="va">childeduc</span><span class="op">)</span></span></code></pre></div>
<p>Note that the first step was to type <code>rr &lt;-</code>. If you don't overwrite <code>rr</code> by specifying this step, R will generate a new tibble with the added variable, but it won't be saved anywhere.</p>
<p>A nice thing about <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> relative to base R is that you can generate a number of variables within the same <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> command. For example, imagine we also want to create a variable that captures childcare time not spent on college prep. In other words, we want to add the variable <code>childnotcollegeprep = childtot - childcollegeprep</code> to the tibble. We can do this using the following:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">rr</span>, childcollegeprep<span class="op">=</span><span class="va">childtravel</span><span class="op">+</span><span class="va">childeduc</span>,</span>
<span>             childnotcollegeprep<span class="op">=</span><span class="va">childtot</span><span class="op">-</span><span class="va">childcollegeprep</span><span class="op">)</span></span></code></pre></div>
<p>If you have more variables to add or change, you can simply add a comma to the end of the last line, and add the new variable below. Note, we can even call variables that are created earlier in the function (i.e. <code>childnotcollegeprep</code> can only be created if <code>childcollegeprep</code> is created first).</p>
<p>Lastly, let's talk about the <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code> function. This function also generates new variables, but at the same time, it drops all pre-existing variables. For example, if you wanted to create a tibble that only contains <code>childcollegeprep</code> and <code>childnotcollegeprep</code>, you could use the <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code> function:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="the-rug-rat-race.html#cb340-1" tabindex="-1"></a>collegeprepdat <span class="ot">&lt;-</span> <span class="fu">transmute</span>(rr,</span>
<span id="cb340-2"><a href="the-rug-rat-race.html#cb340-2" tabindex="-1"></a>                            <span class="at">childcollegeprep =</span> childeduc <span class="sc">+</span> childtravel,</span>
<span id="cb340-3"><a href="the-rug-rat-race.html#cb340-3" tabindex="-1"></a>                            <span class="at">childnotcollegeprep =</span> childtot <span class="sc">-</span> collegeprep)</span>
<span id="cb340-4"><a href="the-rug-rat-race.html#cb340-4" tabindex="-1"></a>Error <span class="cf">in</span> <span class="st">`</span><span class="at">transmute()</span><span class="st">`</span><span class="sc">:</span></span>
<span id="cb340-5"><a href="the-rug-rat-race.html#cb340-5" tabindex="-1"></a>â„¹ In argument<span class="sc">:</span> <span class="st">`</span><span class="at">childnotcollegeprep = childtot -</span></span>
<span id="cb340-6"><a href="the-rug-rat-race.html#cb340-6" tabindex="-1"></a><span class="at">  collegeprep</span><span class="st">`</span>.</span>
<span id="cb340-7"><a href="the-rug-rat-race.html#cb340-7" tabindex="-1"></a>Caused by error<span class="sc">:</span></span>
<span id="cb340-8"><a href="the-rug-rat-race.html#cb340-8" tabindex="-1"></a><span class="sc">!</span> object <span class="st">'collegeprep'</span> not found</span></code></pre></div>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="the-rug-rat-race.html#cb341-1" tabindex="-1"></a>collegeprepdat</span>
<span id="cb341-2"><a href="the-rug-rat-race.html#cb341-2" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">eval</span>(expr, envir, enclos)<span class="sc">:</span> object <span class="st">'collegeprepdat'</span> not found</span></code></pre></div>
<p>As you can see, this is a data set that only contains the two variables we created using <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code>.</p>
</div>
<div id="group-by-and-summarize" class="section level2" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Group By and Summarize<a class="anchor" aria-label="anchor" href="#group-by-and-summarize"><i class="fas fa-link"></i></a>
</h2>
<p>Often in the course of our data analysis we will want to break down some summary statistics by some groups. For example, maybe we have a dataset on individual-level voting records and want to compute average voting rates by state. Maybe we have data on wages over time, and we want to compute the average wage by year. In R, a convenient way to make this calculation is by combing the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function with the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function.</p>
<p>To begin our discussion of these functions, we will first illustrate how to use the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> command before combining it with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Our application will again utilize the data from Ramey and Ramey (2010) on time use.</p>
<p>To remind you, the tibble <code>rr</code> contains the year of the observation in a variable named <code>dataset</code> and the amount spent on childcare in a variable named <code>childtot</code>.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="the-rug-rat-race.html#cb342-1" tabindex="-1"></a><span class="fu">head</span>(rr<span class="sc">$</span>dataset)</span>
<span id="cb342-2"><a href="the-rug-rat-race.html#cb342-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1965</span> <span class="dv">1965</span> <span class="dv">1965</span> <span class="dv">1965</span> <span class="dv">1965</span> <span class="dv">1965</span></span></code></pre></div>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="the-rug-rat-race.html#cb343-1" tabindex="-1"></a><span class="fu">head</span>(rr<span class="sc">$</span>childtot)</span>
<span id="cb343-2"><a href="the-rug-rat-race.html#cb343-2" tabindex="-1"></a>[<span class="dv">1</span>]  <span class="fl">7.000000</span>  <span class="fl">4.666667</span>  <span class="fl">2.916667</span> <span class="fl">42.583332</span>  <span class="fl">7.583333</span></span>
<span id="cb343-3"><a href="the-rug-rat-race.html#cb343-3" tabindex="-1"></a>[<span class="dv">6</span>] <span class="fl">27.183332</span></span></code></pre></div>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function is used to generate summary statistics. For example, imagine I just want to take the average level of <code>childtot</code> across the entire sample. We can do this by typing:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="the-rug-rat-race.html#cb344-1" tabindex="-1"></a><span class="fu">summarize</span>(rr, <span class="at">meanchildtot =</span> <span class="fu">mean</span>(childtot, <span class="at">na.rm=</span>T))</span>
<span id="cb344-2"><a href="the-rug-rat-race.html#cb344-2" tabindex="-1"></a><span class="co"># A tibble: 1 Ã— 1</span></span>
<span id="cb344-3"><a href="the-rug-rat-race.html#cb344-3" tabindex="-1"></a>  meanchildtot</span>
<span id="cb344-4"><a href="the-rug-rat-race.html#cb344-4" tabindex="-1"></a>         <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb344-5"><a href="the-rug-rat-race.html#cb344-5" tabindex="-1"></a><span class="dv">1</span>         <span class="fl">4.69</span></span></code></pre></div>
<p>The first part of the code, <code>summarize(rr,</code> tells R that we are generating summary statistics from the <code>rr</code> data set. The second, part <code>meanchildtot=</code> is actually giving a name to the summary statistic. In other words, you can change this part of the code and the only difference will be the name on the column that is output. The actual code will still execute without error. This is a helpful feature of the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> command because often we will want to save our summary statistics in a new tibble. If there are multiple summary statistics computed, we need to be able to keep track of the various summary statistics. The last part of the code <code>mean(childtot, na.rm=T)</code> is declaring that <code>meanchildtot</code> will be equal to the average of <code>childtot</code>. Because we have specified <code>na.rm=T</code>, missing values are ignored in the computation.</p>
<p>A nice feature of the <code>summarize</code> function is that we can generate multiple statistics in a single line. For example, imagine we would like to compute both the mean level of childcare and the median level of childcare. We can simply add this code to the previous summary command by giving the median a different name:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="the-rug-rat-race.html#cb345-1" tabindex="-1"></a><span class="fu">summarize</span>(rr, </span>
<span id="cb345-2"><a href="the-rug-rat-race.html#cb345-2" tabindex="-1"></a>          <span class="at">meanchildtot =</span> <span class="fu">mean</span>(childtot, <span class="at">na.rm=</span>T),</span>
<span id="cb345-3"><a href="the-rug-rat-race.html#cb345-3" tabindex="-1"></a>          <span class="at">medianchildtot=</span><span class="fu">median</span>(childtot, <span class="at">na.rm =</span> T))</span>
<span id="cb345-4"><a href="the-rug-rat-race.html#cb345-4" tabindex="-1"></a><span class="co"># A tibble: 1 Ã— 2</span></span>
<span id="cb345-5"><a href="the-rug-rat-race.html#cb345-5" tabindex="-1"></a>  meanchildtot medianchildtot</span>
<span id="cb345-6"><a href="the-rug-rat-race.html#cb345-6" tabindex="-1"></a>         <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb345-7"><a href="the-rug-rat-race.html#cb345-7" tabindex="-1"></a><span class="dv">1</span>         <span class="fl">4.69</span>              <span class="dv">0</span></span></code></pre></div>
<p>The median is actually zero here because we are taking the median for the entire sample. Many individuals will have zero time spent on childcare, as there aren't any children in many households.</p>
<p>Next, we will discuss the real usefulness of the summarize command: summarizing by groups. Many times as part of our analysis, we might want to provide summary statistics over some group variable. At other times, we may actually want to change the unit-of-observation of our dataset. Using the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function with the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function is a convenient way to accomplish this.</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function tells R that any subsequent functions should be done separately by the values of the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> variable. For example, in our dataset, we have a list of years:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="the-rug-rat-race.html#cb346-1" tabindex="-1"></a><span class="fu">unique</span>(rr<span class="sc">$</span>dataset)</span>
<span id="cb346-2"><a href="the-rug-rat-race.html#cb346-2" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">1965</span> <span class="dv">1975</span> <span class="dv">1985</span> <span class="dv">1993</span>   <span class="cn">NA</span> <span class="dv">1995</span> <span class="dv">1998</span> <span class="dv">2000</span> <span class="dv">2003</span> <span class="dv">2004</span> <span class="dv">2005</span></span>
<span id="cb346-3"><a href="the-rug-rat-race.html#cb346-3" tabindex="-1"></a>[<span class="dv">12</span>] <span class="dv">2006</span> <span class="dv">2007</span> <span class="dv">2008</span></span></code></pre></div>
<p>Therefore, if we specify <code>group_by(dataset)</code>, then subsequent functions will be applied separately by each value of <code>dataset</code>. In particular, if we next <code>summarize(meanchildtot = mean(childtot, na.rm=T))</code>, then the mean of <code>childtot</code> will be taken separately for each value of <code>dataset</code>. Let's try this all together now.</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>meanchildtot<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">childtot</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 14 Ã— 2
   dataset meanchildtot
     &lt;dbl&gt;        &lt;dbl&gt;
 1    1965         4.27
 2    1975         3.36
 3    1985         2.95
 4    1993         2.09
 5    1995         4.23
 6    1998         5.20
 7    2000        10.5 
 8    2003         4.85
 9    2004         4.73
10    2005         5.17
11    2006         5.06
12    2007         4.92
13    2008         4.97
14      NA       NaN   </code></pre>
<p>The way we can read the code above is: first read in <code>rr</code> tibble, and then group by values of the variable <code>dataset</code>, and then for each value of <code>dataset</code>, take the average of <code>childtot</code>, and store this information under the name <code>meanchildtot</code>.</p>
<p>We can also make this even more complicated by summarizing by two variables. If you type <code>group_by(var1,var2)</code>, then R will group by the unique combination of variables. Before proceeding to the main example, let's generate a small data frame through which we can understand grouping by two variables.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">student.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>school<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>                        graduationdate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">2010</span>,<span class="fl">2015</span>,<span class="fl">2010</span>,<span class="fl">2010</span>,<span class="fl">2015</span><span class="op">)</span>,</span>
<span>                        gpa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.2</span>,<span class="fl">3.7</span>,<span class="fl">2.9</span>,<span class="fl">4.0</span>,<span class="fl">3.2</span>,<span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="the-rug-rat-race.html#cb350-1" tabindex="-1"></a>student.df</span>
<span id="cb350-2"><a href="the-rug-rat-race.html#cb350-2" tabindex="-1"></a>  school graduationdate gpa</span>
<span id="cb350-3"><a href="the-rug-rat-race.html#cb350-3" tabindex="-1"></a><span class="dv">1</span>      A           <span class="dv">2010</span> <span class="fl">3.2</span></span>
<span id="cb350-4"><a href="the-rug-rat-race.html#cb350-4" tabindex="-1"></a><span class="dv">2</span>      A           <span class="dv">2010</span> <span class="fl">3.7</span></span>
<span id="cb350-5"><a href="the-rug-rat-race.html#cb350-5" tabindex="-1"></a><span class="dv">3</span>      A           <span class="dv">2015</span> <span class="fl">2.9</span></span>
<span id="cb350-6"><a href="the-rug-rat-race.html#cb350-6" tabindex="-1"></a><span class="dv">4</span>      B           <span class="dv">2010</span> <span class="fl">4.0</span></span>
<span id="cb350-7"><a href="the-rug-rat-race.html#cb350-7" tabindex="-1"></a><span class="dv">5</span>      B           <span class="dv">2010</span> <span class="fl">3.2</span></span>
<span id="cb350-8"><a href="the-rug-rat-race.html#cb350-8" tabindex="-1"></a><span class="dv">6</span>      B           <span class="dv">2015</span> <span class="fl">1.8</span></span></code></pre></div>
<p>If I type <code>group_by(school,graduationdate)</code>, then any subsequent <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> command will be done completely separately by unique combinations of <code>school</code> and <code>graduationdate</code>. In this data frame, there are 4 unique combinations -- "A 2010", "A 2015", "B 2010", "B 2015". So let's see what we get when we summarize by groups of two variables:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="the-rug-rat-race.html#cb351-1" tabindex="-1"></a>student.df <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="the-rug-rat-race.html#cb351-2" tabindex="-1"></a>  <span class="fu">group_by</span>(school,graduationdate) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="the-rug-rat-race.html#cb351-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.gpa=</span><span class="fu">mean</span>(gpa))</span>
<span id="cb351-4"><a href="the-rug-rat-race.html#cb351-4" tabindex="-1"></a><span class="st">`</span><span class="at">summarise()</span><span class="st">`</span> has grouped output by <span class="st">'school'</span>. You can</span>
<span id="cb351-5"><a href="the-rug-rat-race.html#cb351-5" tabindex="-1"></a>override using the <span class="st">`</span><span class="at">.groups</span><span class="st">`</span> argument.</span>
<span id="cb351-6"><a href="the-rug-rat-race.html#cb351-6" tabindex="-1"></a><span class="co"># A tibble: 4 Ã— 3</span></span>
<span id="cb351-7"><a href="the-rug-rat-race.html#cb351-7" tabindex="-1"></a><span class="co"># Groups:   school [2]</span></span>
<span id="cb351-8"><a href="the-rug-rat-race.html#cb351-8" tabindex="-1"></a>  school graduationdate mean.gpa</span>
<span id="cb351-9"><a href="the-rug-rat-race.html#cb351-9" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb351-10"><a href="the-rug-rat-race.html#cb351-10" tabindex="-1"></a><span class="dv">1</span> A                <span class="dv">2010</span>     <span class="fl">3.45</span></span>
<span id="cb351-11"><a href="the-rug-rat-race.html#cb351-11" tabindex="-1"></a><span class="dv">2</span> A                <span class="dv">2015</span>     <span class="fl">2.9</span> </span>
<span id="cb351-12"><a href="the-rug-rat-race.html#cb351-12" tabindex="-1"></a><span class="dv">3</span> B                <span class="dv">2010</span>     <span class="fl">3.6</span> </span>
<span id="cb351-13"><a href="the-rug-rat-race.html#cb351-13" tabindex="-1"></a><span class="dv">4</span> B                <span class="dv">2015</span>     <span class="fl">1.8</span> </span></code></pre></div>
<p>To understand how the unique combinations are generated, let's change the dataset slightly.</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">student.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>school<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>                        graduationdate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">2010</span>,<span class="fl">2010</span>,<span class="fl">2015</span>,<span class="fl">2015</span>,<span class="fl">2015</span><span class="op">)</span>,</span>
<span>                        gpa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.2</span>,<span class="fl">3.7</span>,<span class="fl">2.9</span>,<span class="fl">4.0</span>,<span class="fl">3.2</span>,<span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now there are only two unique combinations in the data of school and graduation date: "A 2010" and "B 2015". Therefore, when we summarize by groups, there will be only two averages taken:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="the-rug-rat-race.html#cb353-1" tabindex="-1"></a>student.df <span class="sc">%&gt;%</span> </span>
<span id="cb353-2"><a href="the-rug-rat-race.html#cb353-2" tabindex="-1"></a>  <span class="fu">group_by</span>(school,graduationdate) <span class="sc">%&gt;%</span></span>
<span id="cb353-3"><a href="the-rug-rat-race.html#cb353-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.gpa=</span><span class="fu">mean</span>(gpa))</span>
<span id="cb353-4"><a href="the-rug-rat-race.html#cb353-4" tabindex="-1"></a><span class="co"># A tibble: 2 Ã— 3</span></span>
<span id="cb353-5"><a href="the-rug-rat-race.html#cb353-5" tabindex="-1"></a><span class="co"># Groups:   school [2]</span></span>
<span id="cb353-6"><a href="the-rug-rat-race.html#cb353-6" tabindex="-1"></a>  school graduationdate mean.gpa</span>
<span id="cb353-7"><a href="the-rug-rat-race.html#cb353-7" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb353-8"><a href="the-rug-rat-race.html#cb353-8" tabindex="-1"></a><span class="dv">1</span> A                <span class="dv">2010</span>     <span class="fl">3.27</span></span>
<span id="cb353-9"><a href="the-rug-rat-race.html#cb353-9" tabindex="-1"></a><span class="dv">2</span> B                <span class="dv">2015</span>     <span class="dv">3</span>   </span></code></pre></div>
<p>Now, let's return to the <code>rr</code> tibble. In Ramey and Ramey (2010), the authors compared time spent on childcare over time separately for college-educated and less-than-college educated individuals. We can achieve a similar analysis by grouping over <code>dataset</code> and <code>college</code>. The variable <code>college</code> is a variable that takes on a value of 1 if the individual graduated from college, and zero otherwise.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="the-rug-rat-race.html#cb354-1" tabindex="-1"></a>rr <span class="sc">%&gt;%</span></span>
<span id="cb354-2"><a href="the-rug-rat-race.html#cb354-2" tabindex="-1"></a>  <span class="fu">group_by</span>(dataset,college) <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="the-rug-rat-race.html#cb354-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanchildtot =</span> <span class="fu">mean</span>(childtot, <span class="at">na.rm=</span>T))</span>
<span id="cb354-4"><a href="the-rug-rat-race.html#cb354-4" tabindex="-1"></a><span class="co"># A tibble: 27 Ã— 3</span></span>
<span id="cb354-5"><a href="the-rug-rat-race.html#cb354-5" tabindex="-1"></a><span class="co"># Groups:   dataset [14]</span></span>
<span id="cb354-6"><a href="the-rug-rat-race.html#cb354-6" tabindex="-1"></a>   dataset college meanchildtot</span>
<span id="cb354-7"><a href="the-rug-rat-race.html#cb354-7" tabindex="-1"></a>     <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>        <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb354-8"><a href="the-rug-rat-race.html#cb354-8" tabindex="-1"></a> <span class="dv">1</span>    <span class="dv">1965</span>       <span class="dv">0</span>         <span class="fl">4.35</span></span>
<span id="cb354-9"><a href="the-rug-rat-race.html#cb354-9" tabindex="-1"></a> <span class="dv">2</span>    <span class="dv">1965</span>       <span class="dv">1</span>         <span class="fl">3.66</span></span>
<span id="cb354-10"><a href="the-rug-rat-race.html#cb354-10" tabindex="-1"></a> <span class="dv">3</span>    <span class="dv">1975</span>       <span class="dv">0</span>         <span class="fl">3.33</span></span>
<span id="cb354-11"><a href="the-rug-rat-race.html#cb354-11" tabindex="-1"></a> <span class="dv">4</span>    <span class="dv">1975</span>       <span class="dv">1</span>         <span class="fl">3.51</span></span>
<span id="cb354-12"><a href="the-rug-rat-race.html#cb354-12" tabindex="-1"></a> <span class="dv">5</span>    <span class="dv">1985</span>       <span class="dv">0</span>         <span class="fl">2.89</span></span>
<span id="cb354-13"><a href="the-rug-rat-race.html#cb354-13" tabindex="-1"></a> <span class="dv">6</span>    <span class="dv">1985</span>       <span class="dv">1</span>         <span class="fl">3.13</span></span>
<span id="cb354-14"><a href="the-rug-rat-race.html#cb354-14" tabindex="-1"></a> <span class="dv">7</span>    <span class="dv">1993</span>       <span class="dv">0</span>         <span class="fl">2.25</span></span>
<span id="cb354-15"><a href="the-rug-rat-race.html#cb354-15" tabindex="-1"></a> <span class="dv">8</span>    <span class="dv">1993</span>       <span class="dv">1</span>         <span class="fl">1.74</span></span>
<span id="cb354-16"><a href="the-rug-rat-race.html#cb354-16" tabindex="-1"></a> <span class="dv">9</span>    <span class="dv">1995</span>       <span class="dv">0</span>         <span class="fl">4.39</span></span>
<span id="cb354-17"><a href="the-rug-rat-race.html#cb354-17" tabindex="-1"></a><span class="dv">10</span>    <span class="dv">1995</span>       <span class="dv">1</span>         <span class="fl">3.85</span></span>
<span id="cb354-18"><a href="the-rug-rat-race.html#cb354-18" tabindex="-1"></a><span class="co"># â„¹ 17 more rows</span></span></code></pre></div>
<p>To understand this table, let's look at the first row of data. This first row has <code>dataset==1965</code> and <code>college==0</code>. In other words, this row corresponds to individuals in 1965 without a college education. The value in the <code>meanchildtot</code> column is the average amount of time spent on childcare for these individuals. If we move down this table, we will see R has computed the mean time spent on childcare for every unique combination of <code>dataset</code> and <code>college</code>.</p>
<p>Often in practice, we may want to actually save the output of this function. To do so, we just need to assign it a name, as usual:</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">totchildbyyearcollege</span> <span class="op">&lt;-</span> <span class="va">rr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">college</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>meanchildtot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">childtot</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we have created a new tibble <code>totchildbyyearcollege</code> that contains these averages over time by college education.</p>
<p>We could have also accomplished this by looping over values of dataset and college and then computing the means and storing them. But doing so would have included (1) writing much more code and (2) would have actually taken longer to run. Using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> is a much more efficient way to accomplish this.</p>
</div>
<div id="conclusion-5" class="section level2" number="7.9">
<h2>
<span class="header-section-number">7.9</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-5"><i class="fas fa-link"></i></a>
</h2>
<p>In this final section we will put all the various functions we've learned together into one analysis. As a reminder, our goal is to compute the average time spent on childcare for mothers over time, separately by college-education status. In other words, replicate Figure <a href="the-rug-rat-race.html#fig:rugrat">7.1</a> from Ramey and Ramey (2010) which shows increased time spent on childcare beginning in the 1990s, especially for college-educated mothers.</p>
<p>This review will focus on the <code>tidyverse</code> package. As a reminder, the first time using a package you need to install it using <code>install.packages("packagename")</code>. You only need to do this once. However, every time you want to use the package in a given R session, you need to load it into memory using the <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> function. For example, to load tidyverse we would type:</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">libary</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre></div>
<p>To begin, let's first re-load our data into R as a tibble using the <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> function. The <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> function reads in a dataset as a tibble, while the <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> function reads the dataset into memory as a data frame. For our purposes, there won't be too much differences between these formats, but tibbles will be more efficient with large datasets.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="the-rug-rat-race.html#cb357-1" tabindex="-1"></a>rr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"rugratrace.csv"</span>)</span>
<span id="cb357-2"><a href="the-rug-rat-race.html#cb357-2" tabindex="-1"></a>Rows<span class="sc">:</span> <span class="dv">106020</span> Columns<span class="sc">:</span> <span class="dv">54</span></span>
<span id="cb357-3"><a href="the-rug-rat-race.html#cb357-3" tabindex="-1"></a>â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span id="cb357-4"><a href="the-rug-rat-race.html#cb357-4" tabindex="-1"></a>Delimiter<span class="sc">:</span> <span class="st">","</span></span>
<span id="cb357-5"><a href="the-rug-rat-race.html#cb357-5" tabindex="-1"></a><span class="fu">dbl</span> (<span class="dv">54</span>)<span class="sc">:</span> state, age, sex, ethnic, under18, under5, agey...</span>
<span id="cb357-6"><a href="the-rug-rat-race.html#cb357-6" tabindex="-1"></a></span>
<span id="cb357-7"><a href="the-rug-rat-race.html#cb357-7" tabindex="-1"></a>â„¹ Use <span class="st">`</span><span class="at">spec()</span><span class="st">`</span> to retrieve the full column specification <span class="cf">for</span> this data.</span>
<span id="cb357-8"><a href="the-rug-rat-race.html#cb357-8" tabindex="-1"></a>â„¹ Specify the column types or set <span class="st">`</span><span class="at">show_col_types = FALSE</span><span class="st">`</span> to quiet this message.</span></code></pre></div>
<p>Our first issue is that the Ramey and Ramey (2010) analysis was for a particular group of individuals: mothers aged 25-34. Therefore, we first need to create a dataset restricted to these individuals. We can achieve this by using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function.</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers2534</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rr</span>, <span class="va">mother2</span><span class="op">==</span><span class="fl">1</span>, <span class="va">age</span><span class="op">&gt;</span><span class="fl">24</span>, <span class="va">age</span><span class="op">&lt;</span><span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<p>Now, a focus of our analysis will be what is driving the increase in time spent on childcare. One potential driver is increased time spent on college prep activities, given an increase in the competitiveness of college during this time. We are going to add a variable named <code>collegeprep</code> to this dataset which is the time spent either on traveling with children or time spent educating children.</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothers_collegeprep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">mothers2534</span>, </span>
<span>                              collegeprep <span class="op">=</span> <span class="va">childeduc</span> <span class="op">+</span> <span class="va">childtravel</span><span class="op">)</span></span></code></pre></div>
<p>Our goal is to compute the amount of time spent on <code>collegeprep</code> over time, by college education status. We can accomplish this by using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> functions together.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="the-rug-rat-race.html#cb360-1" tabindex="-1"></a>collegeprep <span class="ot">&lt;-</span> mothers_collegeprep <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="the-rug-rat-race.html#cb360-2" tabindex="-1"></a>  <span class="fu">group_by</span>(dataset, college) <span class="sc">%&gt;%</span></span>
<span id="cb360-3"><a href="the-rug-rat-race.html#cb360-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meancollegeprep=</span><span class="fu">mean</span>(collegeprep, <span class="at">na.rm=</span>T))</span>
<span id="cb360-4"><a href="the-rug-rat-race.html#cb360-4" tabindex="-1"></a><span class="st">`</span><span class="at">summarise()</span><span class="st">`</span> has grouped output by <span class="st">'dataset'</span>. You can</span>
<span id="cb360-5"><a href="the-rug-rat-race.html#cb360-5" tabindex="-1"></a>override using the <span class="st">`</span><span class="at">.groups</span><span class="st">`</span> argument.</span></code></pre></div>
<p>Now if we look at our resulting tibble, we can use it to understand trends in time spent on college prep over time:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="the-rug-rat-race.html#cb361-1" tabindex="-1"></a><span class="fu">print</span>(collegeprep,<span class="at">n=</span><span class="dv">25</span>)</span>
<span id="cb361-2"><a href="the-rug-rat-race.html#cb361-2" tabindex="-1"></a><span class="co"># A tibble: 22 Ã— 3</span></span>
<span id="cb361-3"><a href="the-rug-rat-race.html#cb361-3" tabindex="-1"></a><span class="co"># Groups:   dataset [11]</span></span>
<span id="cb361-4"><a href="the-rug-rat-race.html#cb361-4" tabindex="-1"></a>   dataset college meancollegeprep</span>
<span id="cb361-5"><a href="the-rug-rat-race.html#cb361-5" tabindex="-1"></a>     <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>           <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb361-6"><a href="the-rug-rat-race.html#cb361-6" tabindex="-1"></a> <span class="dv">1</span>    <span class="dv">1965</span>       <span class="dv">0</span>            <span class="fl">2.14</span></span>
<span id="cb361-7"><a href="the-rug-rat-race.html#cb361-7" tabindex="-1"></a> <span class="dv">2</span>    <span class="dv">1965</span>       <span class="dv">1</span>            <span class="fl">1.88</span></span>
<span id="cb361-8"><a href="the-rug-rat-race.html#cb361-8" tabindex="-1"></a> <span class="dv">3</span>    <span class="dv">1975</span>       <span class="dv">0</span>            <span class="fl">1.66</span></span>
<span id="cb361-9"><a href="the-rug-rat-race.html#cb361-9" tabindex="-1"></a> <span class="dv">4</span>    <span class="dv">1975</span>       <span class="dv">1</span>            <span class="fl">1.69</span></span>
<span id="cb361-10"><a href="the-rug-rat-race.html#cb361-10" tabindex="-1"></a> <span class="dv">5</span>    <span class="dv">1985</span>       <span class="dv">0</span>            <span class="fl">2.52</span></span>
<span id="cb361-11"><a href="the-rug-rat-race.html#cb361-11" tabindex="-1"></a> <span class="dv">6</span>    <span class="dv">1985</span>       <span class="dv">1</span>            <span class="fl">2.72</span></span>
<span id="cb361-12"><a href="the-rug-rat-race.html#cb361-12" tabindex="-1"></a> <span class="dv">7</span>    <span class="dv">1993</span>       <span class="dv">0</span>            <span class="fl">1.49</span></span>
<span id="cb361-13"><a href="the-rug-rat-race.html#cb361-13" tabindex="-1"></a> <span class="dv">8</span>    <span class="dv">1993</span>       <span class="dv">1</span>            <span class="fl">1.87</span></span>
<span id="cb361-14"><a href="the-rug-rat-race.html#cb361-14" tabindex="-1"></a> <span class="dv">9</span>    <span class="dv">1998</span>       <span class="dv">0</span>            <span class="fl">2.46</span></span>
<span id="cb361-15"><a href="the-rug-rat-race.html#cb361-15" tabindex="-1"></a><span class="dv">10</span>    <span class="dv">1998</span>       <span class="dv">1</span>            <span class="fl">2.51</span></span>
<span id="cb361-16"><a href="the-rug-rat-race.html#cb361-16" tabindex="-1"></a><span class="dv">11</span>    <span class="dv">2003</span>       <span class="dv">0</span>            <span class="fl">3.27</span></span>
<span id="cb361-17"><a href="the-rug-rat-race.html#cb361-17" tabindex="-1"></a><span class="dv">12</span>    <span class="dv">2003</span>       <span class="dv">1</span>            <span class="fl">3.34</span></span>
<span id="cb361-18"><a href="the-rug-rat-race.html#cb361-18" tabindex="-1"></a><span class="dv">13</span>    <span class="dv">2004</span>       <span class="dv">0</span>            <span class="fl">2.87</span></span>
<span id="cb361-19"><a href="the-rug-rat-race.html#cb361-19" tabindex="-1"></a><span class="dv">14</span>    <span class="dv">2004</span>       <span class="dv">1</span>            <span class="fl">3.72</span></span>
<span id="cb361-20"><a href="the-rug-rat-race.html#cb361-20" tabindex="-1"></a><span class="dv">15</span>    <span class="dv">2005</span>       <span class="dv">0</span>            <span class="fl">3.23</span></span>
<span id="cb361-21"><a href="the-rug-rat-race.html#cb361-21" tabindex="-1"></a><span class="dv">16</span>    <span class="dv">2005</span>       <span class="dv">1</span>            <span class="fl">3.05</span></span>
<span id="cb361-22"><a href="the-rug-rat-race.html#cb361-22" tabindex="-1"></a><span class="dv">17</span>    <span class="dv">2006</span>       <span class="dv">0</span>            <span class="fl">3.00</span></span>
<span id="cb361-23"><a href="the-rug-rat-race.html#cb361-23" tabindex="-1"></a><span class="dv">18</span>    <span class="dv">2006</span>       <span class="dv">1</span>            <span class="fl">3.16</span></span>
<span id="cb361-24"><a href="the-rug-rat-race.html#cb361-24" tabindex="-1"></a><span class="dv">19</span>    <span class="dv">2007</span>       <span class="dv">0</span>            <span class="fl">3.18</span></span>
<span id="cb361-25"><a href="the-rug-rat-race.html#cb361-25" tabindex="-1"></a><span class="dv">20</span>    <span class="dv">2007</span>       <span class="dv">1</span>            <span class="fl">3.30</span></span>
<span id="cb361-26"><a href="the-rug-rat-race.html#cb361-26" tabindex="-1"></a><span class="dv">21</span>    <span class="dv">2008</span>       <span class="dv">0</span>            <span class="fl">3.39</span></span>
<span id="cb361-27"><a href="the-rug-rat-race.html#cb361-27" tabindex="-1"></a><span class="dv">22</span>    <span class="dv">2008</span>       <span class="dv">1</span>            <span class="fl">3.28</span></span></code></pre></div>
<p>What do we find in this data? In the 60s-70s, on average, mothers spent around 1.5-2 hours on activities that may be related to college preparation. This increases over time, and by the 2000s, it has stabilized to closer to 3 hours on average. Therefore, we find something broadly consistent with Ramey and Ramey (2010). Time spent on childcare has increased over time, and in particular, for activities that may be related to college preparation.</p>
<p>Now, one thing to note is that we have done this analysis step-by-step. First we restricted our sample, then we added the variables, and lastly we summarized by group. However, we could have also done this entire analysis in a single block of code by stringing together functions using the pipe operator, as is done below:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="the-rug-rat-race.html#cb362-1" tabindex="-1"></a>collegeprep <span class="ot">&lt;-</span> rr <span class="sc">%&gt;%</span></span>
<span id="cb362-2"><a href="the-rug-rat-race.html#cb362-2" tabindex="-1"></a>  <span class="fu">filter</span>(mother2<span class="sc">==</span><span class="dv">1</span>, age<span class="sc">&gt;</span><span class="dv">24</span>, age<span class="sc">&lt;</span><span class="dv">35</span>) <span class="sc">%&gt;%</span></span>
<span id="cb362-3"><a href="the-rug-rat-race.html#cb362-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collegeprep =</span> childeduc <span class="sc">+</span> childtravel) <span class="sc">%&gt;%</span></span>
<span id="cb362-4"><a href="the-rug-rat-race.html#cb362-4" tabindex="-1"></a>  <span class="fu">group_by</span>(dataset, college) <span class="sc">%&gt;%</span></span>
<span id="cb362-5"><a href="the-rug-rat-race.html#cb362-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meancollegeprep=</span><span class="fu">mean</span>(collegeprep, <span class="at">na.rm=</span>T))</span>
<span id="cb362-6"><a href="the-rug-rat-race.html#cb362-6" tabindex="-1"></a><span class="st">`</span><span class="at">summarise()</span><span class="st">`</span> has grouped output by <span class="st">'dataset'</span>. You can</span>
<span id="cb362-7"><a href="the-rug-rat-race.html#cb362-7" tabindex="-1"></a>override using the <span class="st">`</span><span class="at">.groups</span><span class="st">`</span> argument.</span></code></pre></div>
<p>Going forward in the book, the tools we have learned in this section will be very important. It is extremely common to need to perform some data wrangling steps before proceeding to your actual analysis. The tidyverse package has given us a convenient set of functions in order to perform this analysis.</p>
</div>
<div id="function-descriptions-1" class="section level2 unnumbered">
<h2>
<u>Function Descriptions</u><a class="anchor" aria-label="anchor" href="#function-descriptions-1"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdnote">
<p><strong><u>Tidyverse Functions</u></strong></p>
<ul>
<li><p><code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> -- Reads a csv into memory as a tibble. A tibble is similar to a data frame, but more efficient in many settings.</p></li>
<li><p><code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code> -- Converts a data frame to a tibble.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> -- Restricts to certain observations in a data set. For example, <code>filter(df, age&gt;18)</code> would restrict the hypothetical data frame <code>df</code> to individuals with <code>age&gt;18</code>.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> -- Sorts the data based on the value of a variable. For example, <code>arrange(df, age)</code> would sort the dataset <code>df</code> from youngest to oldest.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> -- Selects certain variables from a dataset. It can be used to restrict to only the variables needed for your analysis.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> -- used to generate new variables.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> -- Groups data based on values of a variable. Any subsequent commands will be done separately by the values of the variable.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> -- Used to generate summary statistics. Often combined with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> in order to generate summary statistics by groups.</p></li>
<li>
</ul>
<p><strong><u>Other Functions<u></u></u></strong></p>
<ul>
<li><p><code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> -- Draws a random number from a list of numbers. For example, <code>sample(-1:1,1)</code> draws a single number from the list of numbers <code>-1:1</code>. In other words, it will draw a random number from -1 to 1. <code>sample(c(0,1,2),4)</code> would draw 4 random numbers from the list of numbers 0,1, or 2.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> -- Concatenates text in R. For example, <code>cat("Hello","World")</code> will yield the phrase "Hello World".</p></li>
<li><p><code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> -- Retrieves a list of the unique values a variable takes on.</p></li>
</ul>
<p><strong><u>Installing/Loading Functions<u></u></u></strong></p>
<ul>
<li><p><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> -- Installs a package onto your version of R. For example, <code>install.packages("tidyverse")</code> will install the tidyverse into R. You need to install a package once.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/library.html">library()</a></code> -- Loads a package into memory.</p></li>
</ul>
</div>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><div class="chapter-nav">
<div class="prev"><a href="resume-experiments.html"><span class="header-section-number">6</span> Resume Experiments</a></div>
<div class="next"><a href="automated-pollution-monitoring.html"><span class="header-section-number">8</span> Automated Pollution Monitoring</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-rug-rat-race"><span class="header-section-number">7</span> The Rug Rat Race</a></li>
<li><a class="nav-link" href="#time-diaries"><span class="header-section-number">7.1</span> Time Diaries</a></li>
<li><a class="nav-link" href="#conditional-statements"><span class="header-section-number">7.2</span> Conditional Statements</a></li>
<li><a class="nav-link" href="#for-loops"><span class="header-section-number">7.3</span> For Loops</a></li>
<li><a class="nav-link" href="#for-loops-data"><span class="header-section-number">7.4</span> For Loops (Data)</a></li>
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">7.5</span> Tidyverse</a></li>
<li><a class="nav-link" href="#the-pipe-operator"><span class="header-section-number">7.6</span> The Pipe Operator</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">7.7</span> Mutate</a></li>
<li><a class="nav-link" href="#group-by-and-summarize"><span class="header-section-number">7.8</span> Group By and Summarize</a></li>
<li><a class="nav-link" href="#conclusion-5"><span class="header-section-number">7.9</span> Conclusion</a></li>
<li><a class="nav-link" href="#function-descriptions-1">Function Descriptions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Econ5/Poli5D</strong>" was written by David Arnold. It was last built on 2024-08-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
